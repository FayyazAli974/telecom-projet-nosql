{"paragraphs":[{"text":"%md\n# Remplissage des données dans S3\n\nDans ce notebook nous chargeons les fichiers suivants, provenant de la base de données GDELT, sur une période donnée :\n* Evenements\n* Mentions\n* GKG\n","user":"anonymous","dateUpdated":"2020-01-24T10:12:40+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Remplissage des données dans S3</h1>\n<p>Dans ce notebook nous chargeons les fichiers suivants, provenant de la base de données GDELT, sur une période donnée :<br/>* Evenements<br/>* Mentions<br/>* GKG</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579857145048_2007562778","id":"20181212-100610_115068599","dateCreated":"2020-01-24T09:12:25+0000","dateStarted":"2020-01-24T10:12:40+0000","dateFinished":"2020-01-24T10:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:172"},{"text":"import spark.implicits._\nimport sys.process._\nimport java.net.URL\nimport java.io.File\nimport java.io.File\nimport java.nio.file.{Files, StandardCopyOption}\nimport java.net.HttpURLConnection \nimport org.apache.spark.sql.functions._\n\n// Import connexion à S3\nimport org.apache.spark.sql.SQLContext\nimport org.apache.hadoop.fs.s3a.S3AFileSystem\nimport com.amazonaws.services.s3.transfer.TransferManager\n\n// Imports connexion Cassandra\n/*import org.apache.spark.input.PortableDataStream\nimport org.apache.spark.sql.SQLContext\nimport org.apache.spark.sql.cassandra._\nimport com.datastax.spark.connector._\nimport org.apache.spark.sql.types.IntegerType\n\n// Imports chargement dataframe\nimport org.apache.spark.input.PortableDataStream\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\n\nimport org.apache.spark.sql.functions.regexp_replace\nimport org.apache.spark.sql.functions.explode\nimport org.apache.spark.sql.functions\n\nimport org.apache.spark.sql.types.StringType\nimport org.apache.spark.sql.types.FloatType*/","user":"anonymous","dateUpdated":"2020-01-24T09:18:47+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579857145049_1852823393","id":"20200122-145134_1487213987","dateCreated":"2020-01-24T09:12:25+0000","dateStarted":"2020-01-24T09:18:47+0000","dateFinished":"2020-01-24T09:19:02+0000","status":"ABORT","progressUpdateIntervalMs":500,"$$hashKey":"object:173"},{"text":"def fileDownloader(urlOfFileToDownload: String, fileName: String) = {\n    val url = new URL(urlOfFileToDownload)\n    val connection = url.openConnection().asInstanceOf[HttpURLConnection]\n    connection.setConnectTimeout(5000)\n    connection.setReadTimeout(5000)\n    connection.connect()\n\n    if (connection.getResponseCode >= 400)\n        println(\"error\")\n    else\n        url #> new File(fileName) !!\n}","user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one feature warning; re-run with -feature for details\nfileDownloader: (urlOfFileToDownload: String, fileName: String)Any\n"}]},"apps":[],"jobName":"paragraph_1579857145050_-1198934408","id":"20181209-161931_737140067","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:174"},{"text":"%md\n## Chargement des fichiers master dans S3","user":"anonymous","dateUpdated":"2020-01-24T09:19:12+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Chargement des fichiers master dans S3</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1579857145050_-66445160","id":"20200117-090515_593668969","dateCreated":"2020-01-24T09:12:25+0000","dateStarted":"2020-01-24T09:19:12+0000","dateFinished":"2020-01-24T09:19:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:175"},{"text":"%md\nOn télécharge les fichiers *masterfilelist* GDELT, qui sera stocké sur Spark en local.<br />On vérifie ensuite qu'ils ont bien été téléchargé.","user":"anonymous","dateUpdated":"2020-01-24T09:22:02+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>On télécharge les fichiers <em>masterfilelist</em> GDELT, qui sera stocké sur Spark en local.<br />On vérifie ensuite qu&rsquo;ils ont bien été téléchargé.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579857145050_-1112978252","id":"20181212-101024_1671681559","dateCreated":"2020-01-24T09:12:25+0000","dateStarted":"2020-01-24T09:22:02+0000","dateFinished":"2020-01-24T09:22:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:176"},{"text":"fileDownloader(\"http://data.gdeltproject.org/gdeltv2/masterfilelist.txt\", \"/home/ubuntu/data/masterfilelist.txt\")\nfileDownloader(\"http://data.gdeltproject.org/gdeltv2/masterfilelist-translation.txt\", \"/home/ubuntu/data/masterfilelist-translation.txt\")","user":"anonymous","dateUpdated":"2020-01-24T09:20:03+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res6: Any = \"\"\n"}]},"apps":[],"jobName":"paragraph_1579857145050_-285973779","id":"20181209-162121_1695304399","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:177"},{"text":"%sh\nls -lrth /home/ubuntu/data |grep masterfilelist","user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"-rw-rw-r-- 1 ubuntu ubuntu 53M Jan 23 09:07 masterfilelist.txt\n"}]},"apps":[],"jobName":"paragraph_1579857145051_-2119936055","id":"20181210-111357_801203770","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:178"},{"text":"// == Code avec identifiants AWS ==\n\n//import com.amazonaws.services.s3.AmazonS3Client\n//import com.amazonaws.auth.BasicAWSCredentials\n//import com.amazonaws.auth.DefaultAWSCredentialsProviderChain\n\n//val AWS_ID = \"ASIAZTSUL2OZIHFCANP5\"\n//val AWS_KEY = \"mS5tG/o8eWH12dtkkF9aeYuy3ZGar9rz4n6Q1zz8\"\n// la classe AmazonS3Client n'est pas serializable\n// on rajoute l'annotation @transient pour dire a Spark de ne pas essayer de serialiser cette classe et l'envoyer aux executeurs\n//@transient val awsClient = new AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY))\n\n//sc.hadoopConfiguration.set(\"fs.s3a.access.key\", AWS_ID) // mettre votre ID du fichier credentials.csv\n//sc.hadoopConfiguration.set(\"fs.s3a.secret.key\", AWS_KEY) // mettre votre secret du fichier credentials.csv\n\n// == Code sans identifiants AWS ==\n\nimport com.amazonaws.services.s3.AmazonS3ClientBuilder\nimport com.amazonaws.services.s3.AmazonS3\n\n@transient val awsClient = AmazonS3ClientBuilder.standard().withRegion(\"us-east-1\").build();\nawsClient.putObject(\"thomas-gdelt\", \"masterfilelist.txt\", new File( \"/home/ubuntu/data/masterfilelist.txt\"))\nawsClient.putObject(\"thomas-gdelt\", \"masterfilelist-translation.txt\", new File( \"/home/ubuntu/data/masterfilelist-translation.txt\"))\n","user":"anonymous","dateUpdated":"2020-01-24T09:23:13+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"<console>:96: error: object AmazonS3ClientBuilder is not a member of package com.amazonaws.services.s3\n       import com.amazonaws.services.s3.AmazonS3ClientBuilder\n              ^\n<console>:99: error: not found: value AmazonS3ClientBuilder\n       @transient val awsClient = AmazonS3ClientBuilder.standard().withRegion(\"us-east-1\").build();\n                                  ^\n"}]},"apps":[],"jobName":"paragraph_1579857145051_-779930336","id":"20181212-095117_1356104178","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:179"},{"text":"%md\nOn charge le contenu des fichiers masterfile dans un dataframe chacun, que l'on fusionne en un seul dataframe, qui contiendra ainsi la liste de tous les fichiers téléchargeables sur GDELT.","user":"anonymous","dateUpdated":"2020-01-24T09:24:27+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>On charge le contenu des fichiers masterfile dans un dataframe chacun, que l&rsquo;on fusionne en un seul dataframe, qui contiendra ainsi la liste de tous les fichiers téléchargeables sur GDELT.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579857145052_-669758316","id":"20181212-101258_954978327","dateCreated":"2020-01-24T09:12:25+0000","dateStarted":"2020-01-24T09:24:27+0000","dateFinished":"2020-01-24T09:24:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:180"},{"text":"val sqlContext = new SQLContext(sc)\nval masterFileDF = sqlContext.read.\n                    option(\"delimiter\",\" \").\n                    option(\"infer_schema\",\"true\").\n                    csv(\"s3a://thomas-gdelt/masterfilelist.txt\").\n                    withColumnRenamed(\"_c0\",\"size\").\n                    withColumnRenamed(\"_c1\",\"hash\").\n                    withColumnRenamed(\"_c2\",\"url\")\n                    \nval masterFileTranslationDF = sqlContext.read.\n                    option(\"delimiter\",\" \").\n                    option(\"infer_schema\",\"true\").\n                    csv(\"s3a://thomas-gdelt/masterfilelist-translation.txt\").\n                    withColumnRenamed(\"_c0\",\"size\").\n                    withColumnRenamed(\"_c1\",\"hash\").\n                    withColumnRenamed(\"_c2\",\"url\")","user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nsqlContext: org.apache.spark.sql.SQLContext = org.apache.spark.sql.SQLContext@266ceec3\nmasterFileDF: org.apache.spark.sql.DataFrame = [size: string, hash: string ... 1 more field]\nmasterFileTranslationDF: org.apache.spark.sql.DataFrame = [size: string, hash: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1579857145052_209135029","id":"20181209-163052_14263535","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:181"},{"text":"masterFileTranslationDF.show(false)","user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------------------------+--------------------------------------------------------------------------------+\n|size   |hash                            |url                                                                             |\n+-------+--------------------------------+--------------------------------------------------------------------------------+\n|49305  |18f9b16f0bc6b1e203b963264b7c90f1|http://data.gdeltproject.org/gdeltv2/20150218224500.translation.export.CSV.zip  |\n|133082 |d019304ace29aec800f688b616fceb06|http://data.gdeltproject.org/gdeltv2/20150218224500.translation.mentions.CSV.zip|\n|9117874|fb4bb6d180eb8cde5825a8e6dbab1865|http://data.gdeltproject.org/gdeltv2/20150218224500.translation.gkg.csv.zip     |\n|59173  |b634baabd40fbe078f723829e7e4639f|http://data.gdeltproject.org/gdeltv2/20150218230000.translation.export.CSV.zip  |\n|151173 |19921c77b5d898f313ded534fdc1cd61|http://data.gdeltproject.org/gdeltv2/20150218230000.translation.mentions.CSV.zip|\n|9347350|db36bcb7337c67995cf642cff397a449|http://data.gdeltproject.org/gdeltv2/20150218230000.translation.gkg.csv.zip     |\n|61560  |438901a1a6b75d89c7475e0740a78d74|http://data.gdeltproject.org/gdeltv2/20150218231500.translation.export.CSV.zip  |\n|128215 |943cfb011bed59bf6957e20ca59e87f3|http://data.gdeltproject.org/gdeltv2/20150218231500.translation.mentions.CSV.zip|\n|9637181|1e345742a552d8251dc1b4c991a56f8f|http://data.gdeltproject.org/gdeltv2/20150218231500.translation.gkg.csv.zip     |\n|49096  |9d763e90b5a57a90e0600f37ba067c14|http://data.gdeltproject.org/gdeltv2/20150218233000.translation.export.CSV.zip  |\n|113273 |ef8af93958669cc1124dc77c52e852a6|http://data.gdeltproject.org/gdeltv2/20150218233000.translation.mentions.CSV.zip|\n|8590990|71271dcb812a1581fddb38ff803d1a51|http://data.gdeltproject.org/gdeltv2/20150218233000.translation.gkg.csv.zip     |\n|54081  |defacc35f0e858bc87bd09619aa6fdfa|http://data.gdeltproject.org/gdeltv2/20150218234500.translation.export.CSV.zip  |\n|127165 |ca78766b7499a649f6d5408b63ad65a2|http://data.gdeltproject.org/gdeltv2/20150218234500.translation.mentions.CSV.zip|\n|9016447|da1dbe6c4989fdc48fe45ddbfa320387|http://data.gdeltproject.org/gdeltv2/20150218234500.translation.gkg.csv.zip     |\n|132648 |84ac55ff9e0dcf91a044ea9e2c972ad8|http://data.gdeltproject.org/gdeltv2/20150219000000.translation.export.CSV.zip  |\n|111309 |9059cd44cfc0a2e38e39a5974ca614a6|http://data.gdeltproject.org/gdeltv2/20150219000000.translation.mentions.CSV.zip|\n|8564348|9c0b6080979f107dee9f9126ac78e1a0|http://data.gdeltproject.org/gdeltv2/20150219000000.translation.gkg.csv.zip     |\n|121175 |076734aa904bb95533ff06ffe34738a5|http://data.gdeltproject.org/gdeltv2/20150219001500.translation.export.CSV.zip  |\n|122744 |d65f88aea37ca71902f519ea5e0859d7|http://data.gdeltproject.org/gdeltv2/20150219001500.translation.mentions.CSV.zip|\n+-------+--------------------------------+--------------------------------------------------------------------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1579857145052_-1943230262","id":"20200123-091737_2070665801","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:182"},{"text":"val masterFileAllDF = masterFileDF.union(masterFileTranslationDF).cache\nmasterFileAllDF.show(false)","user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+--------------------------------+--------------------------------------------------------------------+\n|size    |hash                            |url                                                                 |\n+--------+--------------------------------+--------------------------------------------------------------------+\n|150383  |297a16b493de7cf6ca809a7cc31d0b93|http://data.gdeltproject.org/gdeltv2/20150218230000.export.CSV.zip  |\n|318084  |bb27f78ba45f69a17ea6ed7755e9f8ff|http://data.gdeltproject.org/gdeltv2/20150218230000.mentions.CSV.zip|\n|10768507|ea8dde0beb0ba98810a92db068c0ce99|http://data.gdeltproject.org/gdeltv2/20150218230000.gkg.csv.zip     |\n|149211  |2a91041d7e72b0fc6a629e2ff867b240|http://data.gdeltproject.org/gdeltv2/20150218231500.export.CSV.zip  |\n|339037  |dec3f427076b716a8112b9086c342523|http://data.gdeltproject.org/gdeltv2/20150218231500.mentions.CSV.zip|\n|10269336|2f1a504a3c4558694ade0442e9a5ae6f|http://data.gdeltproject.org/gdeltv2/20150218231500.gkg.csv.zip     |\n|149723  |12268e821823aae2da90882621feda18|http://data.gdeltproject.org/gdeltv2/20150218233000.export.CSV.zip  |\n|357229  |744acad14559f2781a8db67715d63872|http://data.gdeltproject.org/gdeltv2/20150218233000.mentions.CSV.zip|\n|11279827|66b03e2efd7d51dabf916b1666910053|http://data.gdeltproject.org/gdeltv2/20150218233000.gkg.csv.zip     |\n|158842  |a5298ce3c6df1a8a759c61b5c0b6f8bb|http://data.gdeltproject.org/gdeltv2/20150218234500.export.CSV.zip  |\n|374528  |dd322c888f28311aca2c735468405551|http://data.gdeltproject.org/gdeltv2/20150218234500.mentions.CSV.zip|\n|11212939|cd20f295649b214dd16666ca451b9994|http://data.gdeltproject.org/gdeltv2/20150218234500.gkg.csv.zip     |\n|362610  |c4268d558bb22c02b3c132c17818c68b|http://data.gdeltproject.org/gdeltv2/20150219000000.export.CSV.zip  |\n|287807  |e7f464a7a451ad2af6e9c8fa24f0ccea|http://data.gdeltproject.org/gdeltv2/20150219000000.mentions.CSV.zip|\n|9728953 |8f4b26e134bd6605cce2d32e92e5d3d7|http://data.gdeltproject.org/gdeltv2/20150219000000.gkg.csv.zip     |\n|251605  |7685a6c71f010918f3be0d4ed2be977e|http://data.gdeltproject.org/gdeltv2/20150219001500.export.CSV.zip  |\n|263793  |e23ee65a60a1577dc74b979a54da406e|http://data.gdeltproject.org/gdeltv2/20150219001500.mentions.CSV.zip|\n|9459370 |6031464dfdcb331551d491916d400c18|http://data.gdeltproject.org/gdeltv2/20150219001500.gkg.csv.zip     |\n|255259  |f41066efb05d4024fca9dc1c2c6b9112|http://data.gdeltproject.org/gdeltv2/20150219003000.export.CSV.zip  |\n|308019  |061133d1efd29c66c7ecba0d52063927|http://data.gdeltproject.org/gdeltv2/20150219003000.mentions.CSV.zip|\n+--------+--------------------------------+--------------------------------------------------------------------+\nonly showing top 20 rows\n\nmasterFileAllDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1579857145053_1070527821","id":"20200123-091404_1107907082","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:183"},{"text":"%md\n## Upload des fichiers dans S3 sur la période donnée","user":"anonymous","dateUpdated":"2020-01-24T09:25:23+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Upload des fichiers dans S3 sur la période donnée</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1579857145053_559319729","id":"20200117-090921_1088801383","dateCreated":"2020-01-24T09:12:25+0000","dateStarted":"2020-01-24T09:25:23+0000","dateFinished":"2020-01-24T09:25:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:184"},{"text":"%md \nOn charge la liste des fichiers de décembre 2019 dans un dataframe","user":"anonymous","dateUpdated":"2020-01-24T09:27:43+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>On charge la liste des fichiers de décembre 2019 dans un dataframe</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579857145053_-382665891","id":"20181212-101345_616653479","dateCreated":"2020-01-24T09:12:25+0000","dateStarted":"2020-01-24T09:27:43+0000","dateFinished":"2020-01-24T09:27:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:185"},{"text":"val sampleDF = masterFileAllDF.filter($\"url\" rlike \"201912[0-9]*\").cache\nprintln(sampleDF.count())\nsampleDF.show(false)","user":"anonymous","dateUpdated":"2020-01-24T09:26:27+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"sampleDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1579857145054_-752683676","id":"20181209-162427_816541907","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:186"},{"text":"%md On upload les fichiers dans le bucket S3 via un ETL Spark","user":"anonymous","dateUpdated":"2020-01-24T09:28:15+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>On upload les fichiers dans le bucket S3 via un ETL Spark</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579857145054_1614622378","id":"20181212-101426_1390220831","dateCreated":"2020-01-24T09:12:25+0000","dateStarted":"2020-01-24T09:28:15+0000","dateFinished":"2020-01-24T09:28:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:187"},{"text":"import com.amazonaws.services.s3.AmazonS3Client\nimport com.amazonaws.auth.BasicAWSCredentials\n\nobject AwsClient{\n    val s3 = new AmazonS3Client()\n}\n\nsampleDF.select(\"url\").repartition(100).foreach( r=> {\n            val URL = r.getAs[String](0)\n            val fileName = r.getAs[String](0).split(\"/\").last\n            val dir = \"/home/ubuntu/data/\"\n            val localFileName = dir + fileName\n            fileDownloader(URL, localFileName)\n            println(URL)\n            val localFile = new File(localFileName)\n            AwsClient.s3.putObject(\"thomas-gdelt/data\", fileName, localFile)\n            localFile.delete()\n})","user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import com.amazonaws.services.s3.AmazonS3Client\nimport com.amazonaws.auth.BasicAWSCredentials\ndefined object AwsClient\n"}]},"apps":[],"jobName":"paragraph_1579857145055_526418747","id":"20181209-163933_1336720866","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:188"},{"text":"","user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579857145071_1472905236","id":"20200123-190016_1464934331","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:189"},{"user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579857145071_-1191221498","id":"20200123-190033_214413057","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:190"},{"text":"\r\n","user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579857145071_570358301","id":"20200123-183854_1320611599","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:191"},{"user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579857145072_-1941304431","id":"20200123-172512_1456076424","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:192"},{"user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579857145072_1208345933","id":"20200123-161419_370953900","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:193"},{"user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579857145072_-1353653263","id":"20200123-161420_219926060","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:194"},{"user":"anonymous","dateUpdated":"2020-01-24T09:12:25+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579857145072_-305203863","id":"20200123-161423_2020522519","dateCreated":"2020-01-24T09:12:25+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:195"}],"name":"feed-s3","id":"2EY8FHWT5","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}