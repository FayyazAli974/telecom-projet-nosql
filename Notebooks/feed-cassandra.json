{"paragraphs":[{"text":"%md\n# Remplissage des données dans Cassandra\n\nDans ce notebook nous chargeons les fichiers depuis S3 dans des dataframes. Nous retraitons les dataframes en fonction de nos besoins pour les requêtes que nous effectuerons à la fin du pipeline. Nous écrivons ensuite ces dataframes dans des tables Cassandra.","user":"anonymous","dateUpdated":"2020-01-24T10:14:02+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Remplissage des données dans Cassandra</h1>\n<p>Dans ce notebook nous chargeons les fichiers depuis S3 dans des dataframes. Nous retraitons les dataframes en fonction de nos besoins pour les requêtes que nous effectuerons à la fin du pipeline. Nous écrivons ensuite ces dataframes dans des tables Cassandra.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1579860719658_926535232","id":"20181212-100610_115068599","dateCreated":"2020-01-24T10:11:59+0000","dateStarted":"2020-01-24T10:14:02+0000","dateFinished":"2020-01-24T10:14:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5643"},{"text":"import spark.implicits._\nimport sys.process._\nimport java.net.URL\nimport java.io.File\nimport java.io.File\nimport java.nio.file.{Files, StandardCopyOption}\nimport java.net.HttpURLConnection \nimport org.apache.spark.sql.functions._\n\n// Import connexion à S3\nimport org.apache.spark.sql.SQLContext\nimport org.apache.hadoop.fs.s3a.S3AFileSystem\nimport com.amazonaws.services.s3.transfer.TransferManager\n\n// Imports connexion Cassandra\nimport org.apache.spark.input.PortableDataStream\nimport org.apache.spark.sql.SQLContext\nimport org.apache.spark.sql.cassandra._\nimport com.datastax.spark.connector._\nimport org.apache.spark.sql.types.IntegerType\n\n// Imports chargement dataframe\nimport org.apache.spark.input.PortableDataStream\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\n\nimport org.apache.spark.sql.functions.regexp_replace\nimport org.apache.spark.sql.functions.explode\nimport org.apache.spark.sql.functions\n\nimport org.apache.spark.sql.types.StringType\nimport org.apache.spark.sql.types.FloatType","user":"anonymous","dateUpdated":"2020-01-24T10:14:36+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719658_533428295","id":"20200122-145134_1487213987","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5644"},{"text":"%md \n# Chargement des données depuis S3","user":"anonymous","dateUpdated":"2020-01-24T10:22:12+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Chargement des données depuis S3</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1579861317565_978439914","id":"20200124-102157_711190138","dateCreated":"2020-01-24T10:21:57+0000","dateStarted":"2020-01-24T10:22:12+0000","dateFinished":"2020-01-24T10:22:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5645"},{"text":"%md\n## Chargement des événements dans un dataframe","user":"anonymous","dateUpdated":"2020-01-24T10:20:31+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Chargement des événements dans un dataframe</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1579860719661_643409387","id":"20200122-165844_965741197","dateCreated":"2020-01-24T10:11:59+0000","dateStarted":"2020-01-24T10:20:31+0000","dateFinished":"2020-01-24T10:20:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5646"},{"text":"// Chargement dans un RDD\nval eventsRDD = sc.binaryFiles(\"s3a://thomas-gdelt/data/201912[0-9]*.export.CSV.zip\").\n      flatMap { // decompresser les fichiers\n        case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n            takeWhile{ case null => zis.close(); false\n            case _ => true }.\n            flatMap { _ =>\n              val br = new BufferedReader(new InputStreamReader(zis))\n              Stream.continually(br.readLine()).takeWhile(_ != null)\n            }\n      }","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"eventsRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[99] at flatMap at <console>:64\n"}]},"apps":[],"jobName":"paragraph_1579860719661_-1166175708","id":"20200122-165317_1693825542","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5647"},{"text":"// Conversion du RDD en dataframe\nval arrays = eventsRDD.map(_.split(\"\\t\")) \nval maxCols = arrays.first().length\nval eventsDF = arrays.toDF(\"arr\")\n  .select((0 until maxCols).map(i => $\"arr\"(i).as(s\"col_$i\")): _*)\n\neventsDF.show()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+--------+------+-----+---------+------+--------------+-----+-----+-----+------+------+------+------+------+------+--------------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+-----------------+------+--------------------+------+------+------+--------+---------+--------+------+--------------------+------+------+------+--------+---------+--------+------+--------------------+------+------+------+--------+---------+--------+--------------+--------------------+\n|    col_0|   col_1| col_2|col_3|    col_4| col_5|         col_6|col_7|col_8|col_9|col_10|col_11|col_12|col_13|col_14|col_15|        col_16|col_17|col_18|col_19|col_20|col_21|col_22|col_23|col_24|col_25|col_26|col_27|col_28|col_29|col_30|col_31|col_32|col_33|           col_34|col_35|              col_36|col_37|col_38|col_39|  col_40|   col_41|  col_42|col_43|              col_44|col_45|col_46|col_47|  col_48|   col_49|  col_50|col_51|              col_52|col_53|col_54|col_55|  col_56|   col_57|  col_58|        col_59|              col_60|\n+---------+--------+------+-----+---------+------+--------------+-----+-----+-----+------+------+------+------+------+------+--------------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+-----------------+------+--------------------+------+------+------+--------+---------+--------+------+--------------------+------+------+------+--------+---------+--------+------+--------------------+------+------+------+--------+---------+--------+--------------+--------------------+\n|890018526|20181201|201812| 2018|2018.9068|      |              |     |     |     |      |      |      |      |      |   GBR|UNITED KINGDOM|   GBR|      |      |      |      |      |      |      |     1|   084|   084|    08|     2|   7.0|     2|     1|     2|-8.74587458745875|     0|                    |      |      |      |        |         |        |     4|Cambridge, Cambri...|    UK|  UKC3| 40098|    52.2| 0.116667|-2591658|     4|Cambridge, Cambri...|    UK|  UKC3| 40098|    52.2| 0.116667|-2591658|20191201000000|https://41nbc.com...|\n|890018527|20181201|201812| 2018|2018.9068|   COP|        POLICE|     |     |     |      |      |   COP|      |      |      |              |      |      |      |      |      |      |      |      |     1|  0841|   084|    08|     2|   7.0|     6|     1|     6|-2.80898876404495|     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|     0|                    |      |      |      |        |         |        |     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|20191201000000|https://41nbc.com...|\n|890018528|20181201|201812| 2018|2018.9068|   COP|        POLICE|     |     |     |      |      |   COP|      |      |   GBR|UNITED KINGDOM|   GBR|      |      |      |      |      |      |      |     1|  0841|   084|    08|     2|   7.0|     4|     1|     4|-2.80898876404495|     4|Londonbridge, Sou...|    UK|  UKM8| 40110|    51.5|-0.083333|-2601893|     4|Londonbridge, Sou...|    UK|  UKM8| 40110|    51.5|-0.083333|-2601893|     4|Londonbridge, Sou...|    UK|  UKM8| 40110|    51.5|-0.083333|-2601893|20191201000000|https://41nbc.com...|\n|890018529|20181201|201812| 2018|2018.9068|   GBR|       BRITISH|  GBR|     |     |      |      |      |      |      |   PAK|      PAKISTAN|   PAK|      |      |      |      |      |      |      |     0|   084|   084|    08|     2|   7.0|     4|     2|     4|-7.36775818639798|     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|     4|Usman Khan, Sindh...|    PK|  PK05| 23687|  27.704|  67.8813| 6047012|     4|Usman Khan, Sindh...|    PK|  PK05| 23687|  27.704|  67.8813| 6047012|20191201000000|https://www.warwi...|\n|890018530|20181201|201812| 2018|2018.9068|   GBR|       BRITISH|  GBR|     |     |      |      |      |      |      |   PAK|      PAKISTAN|   PAK|      |      |      |      |      |      |      |     0|   084|   084|    08|     2|   7.0|     4|     2|     4|-7.36775818639798|     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|     1|         Afghanistan|    AF|    AF|      |      33|       66|      AF|     1|         Afghanistan|    AF|    AF|      |      33|       66|      AF|20191201000000|https://www.warwi...|\n|890018531|20181201|201812| 2018|2018.9068|   GBR|       BRITISH|  GBR|     |     |      |      |      |      |      |   PAK|      PAKISTAN|   PAK|      |      |      |      |      |      |      |     0|   173|   173|    17|     4|  -5.0|     4|     2|     4|-7.36775818639798|     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|     4|Usman Khan, Sindh...|    PK|  PK05| 23687|  27.704|  67.8813| 6047012|     4|Usman Khan, Sindh...|    PK|  PK05| 23687|  27.704|  67.8813| 6047012|20191201000000|https://www.warwi...|\n|890018532|20181201|201812| 2018|2018.9068|   GBR|       BRITISH|  GBR|     |     |      |      |      |      |      |   PAK|      PAKISTAN|   PAK|      |      |      |      |      |      |      |     0|   173|   173|    17|     4|  -5.0|     4|     2|     4|-7.36775818639798|     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|     1|         Afghanistan|    AF|    AF|      |      33|       66|      AF|     1|         Afghanistan|    AF|    AF|      |      33|       66|      AF|20191201000000|https://www.warwi...|\n|890018533|20181201|201812| 2018|2018.9068|   GBR|UNITED KINGDOM|  GBR|     |     |      |      |      |      |      |PAKUAF|      PAKISTAN|   PAK|      |      |      |      |   UAF|      |      |     0|   084|   084|    08|     2|   7.0|     8|     2|     8|-7.36775818639798|     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|     4|Usman Khan, Sindh...|    PK|  PK05| 23687|  27.704|  67.8813| 6047012|     4|Usman Khan, Sindh...|    PK|  PK05| 23687|  27.704|  67.8813| 6047012|20191201000000|https://www.warwi...|\n|890018534|20181201|201812| 2018|2018.9068|   GBR|UNITED KINGDOM|  GBR|     |     |      |      |      |      |      |PAKUAF|      PAKISTAN|   PAK|      |      |      |      |   UAF|      |      |     0|   173|   173|    17|     4|  -5.0|     8|     2|     8|-7.36775818639798|     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|     4|Usman Khan, Sindh...|    PK|  PK05| 23687|  27.704|  67.8813| 6047012|     4|Usman Khan, Sindh...|    PK|  PK05| 23687|  27.704|  67.8813| 6047012|20191201000000|https://www.warwi...|\n|890018535|20181201|201812| 2018|2018.9068|   GBR|       BRITISH|  GBR|     |     |      |      |      |      |      |   UAF|     TERRORIST|      |      |      |      |      |   UAF|      |      |     0|   084|   084|    08|     2|   7.0|     4|     2|     4|-7.36775818639798|     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|     4|Usman Khan, Sindh...|    PK|  PK05| 23687|  27.704|  67.8813| 6047012|     4|Usman Khan, Sindh...|    PK|  PK05| 23687|  27.704|  67.8813| 6047012|20191201000000|https://www.warwi...|\n|890018536|20181201|201812| 2018|2018.9068|   GBR|       BRITISH|  GBR|     |     |      |      |      |      |      |   UAF|     TERRORIST|      |      |      |      |      |   UAF|      |      |     0|   173|   173|    17|     4|  -5.0|     4|     2|     4|-7.36775818639798|     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|     4|Usman Khan, Sindh...|    PK|  PK05| 23687|  27.704|  67.8813| 6047012|     4|Usman Khan, Sindh...|    PK|  PK05| 23687|  27.704|  67.8813| 6047012|20191201000000|https://www.warwi...|\n|890018537|20191101|201911| 2019|2019.8247|AUSEDU|     AUSTRALIA|  AUS|     |     |      |      |   EDU|      |      |   COP|        POLICE|      |      |      |      |      |   COP|      |      |     1|   173|   173|    17|     4|  -5.0|     8|     2|     8|-5.98802395209581|     4|Nudgee, Queenslan...|    AS|  AS04|154682|-27.3667|  153.083|-1592393|     4|Nudgee, Queenslan...|    AS|  AS04|154682|-27.3667|  153.083|-1592393|     4|Nudgee, Queenslan...|    AS|  AS04|154682|-27.3667|  153.083|-1592393|20191201000000|https://www.warwi...|\n|890018538|20191101|201911| 2019|2019.8247|AUSEDU|     AUSTRALIA|  AUS|     |     |      |      |   EDU|      |      |   COP|        POLICE|      |      |      |      |      |   COP|      |      |     1|   180|   180|    18|     4|  -9.0|     8|     2|     8|-5.98802395209581|     4|Nudgee, Queenslan...|    AS|  AS04|154682|-27.3667|  153.083|-1592393|     4|Nudgee, Queenslan...|    AS|  AS04|154682|-27.3667|  153.083|-1592393|     4|Nudgee, Queenslan...|    AS|  AS04|154682|-27.3667|  153.083|-1592393|20191201000000|https://www.warwi...|\n|890018539|20191101|201911| 2019|2019.8247|   EDU|       STUDENT|     |     |     |      |      |   EDU|      |      |   COP|        POLICE|      |      |      |      |      |   COP|      |      |     1|   173|   173|    17|     4|  -5.0|     2|     2|     2|-5.98802395209581|     4|Nudgee, Queenslan...|    AS|  AS04|154682|-27.3667|  153.083|-1592393|     4|Nudgee, Queenslan...|    AS|  AS04|154682|-27.3667|  153.083|-1592393|     4|Nudgee, Queenslan...|    AS|  AS04|154682|-27.3667|  153.083|-1592393|20191201000000|https://www.warwi...|\n|890018540|20191101|201911| 2019|2019.8247|   EDU|       STUDENT|     |     |     |      |      |   EDU|      |      |   COP|        POLICE|      |      |      |      |      |   COP|      |      |     1|   180|   180|    18|     4|  -9.0|     2|     2|     2|-5.98802395209581|     4|Nudgee, Queenslan...|    AS|  AS04|154682|-27.3667|  153.083|-1592393|     4|Nudgee, Queenslan...|    AS|  AS04|154682|-27.3667|  153.083|-1592393|     4|Nudgee, Queenslan...|    AS|  AS04|154682|-27.3667|  153.083|-1592393|20191201000000|https://www.warwi...|\n|890018541|20191101|201911| 2019|2019.8247|MOSGOV|       ISLAMIC|     |     |     |   MOS|      |   GOV|      |      |   SYR|         SYRIA|   SYR|      |      |      |      |      |      |      |     0|  1831|   183|    18|     4| -10.0|     2|     1|     2|-1.97421434327156|     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|     4|Kremlin, Moskva, ...|    RS|  RS48| 25106| 55.7522|  37.6156|-2960561|     1|               Syria|    SY|    SY|      |      35|       38|      SY|20191201000000|https://www.daily...|\n|890018542|20191101|201911| 2019|2019.8247|MOSGOV|       ISLAMIC|     |     |     |   MOS|      |   GOV|      |      |   SYR|         SYRIA|   SYR|      |      |      |      |      |      |      |     0|  1831|   183|    18|     4| -10.0|     2|     1|     2|-1.97421434327156|     1|               Syria|    SY|    SY|      |      35|       38|      SY|     4|Kremlin, Moskva, ...|    RS|  RS48| 25106| 55.7522|  37.6156|-2960561|     1|               Syria|    SY|    SY|      |      35|       38|      SY|20191201000000|https://www.daily...|\n|890018543|20191101|201911| 2019|2019.8247|MOSGOV|       ISLAMIC|     |     |     |   MOS|      |   GOV|      |      |   SYR|         SYRIA|   SYR|      |      |      |      |      |      |      |     0|  1831|   183|    18|     4| -10.0|     6|     1|     6|-1.97421434327156|     1|               Syria|    SY|    SY|      |      35|       38|      SY|     1|               Syria|    SY|    SY|      |      35|       38|      SY|     1|               Syria|    SY|    SY|      |      35|       38|      SY|20191201000000|https://www.daily...|\n|890018544|20191124|201911| 2019|2019.8877|   FRA|        FRANCE|  FRA|     |     |      |      |      |      |      |      |              |      |      |      |      |      |      |      |      |     0|   044|   044|    04|     1|   2.5|     4|     2|     4|-7.36775818639798|     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|     0|                    |      |      |      |        |         |        |     4|London, London, C...|    UK|  UKH9| 40110|    51.5|-0.116667|-2601889|20191201000000|https://www.warwi...|\n|890018545|20191124|201911| 2019|2019.8877|   FRA|        FRANCE|  FRA|     |     |      |      |      |      |      |      |              |      |      |      |      |      |      |      |      |     0|   044|   044|    04|     1|   2.5|    16|     2|    16|-7.36775818639798|     1|              France|    FR|    FR|      |      46|        2|      FR|     0|                    |      |      |      |        |         |        |     1|              France|    FR|    FR|      |      46|        2|      FR|20191201000000|https://www.warwi...|\n+---------+--------+------+-----+---------+------+--------------+-----+-----+-----+------+------+------+------+------+------+--------------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+-----------------+------+--------------------+------+------+------+--------+---------+--------+------+--------------------+------+------+------+--------+---------+--------+------+--------------------+------+------+------+--------+---------+--------+--------------+--------------------+\nonly showing top 20 rows\n\narrays: org.apache.spark.rdd.RDD[Array[String]] = MapPartitionsRDD[100] at map at <console>:66\nmaxCols: Int = 61\neventsDF: org.apache.spark.sql.DataFrame = [col_0: string, col_1: string ... 59 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719661_-1648124345","id":"20200117-103844_729873588","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5648"},{"text":"// Sélection des colonnes nécessaires pour la suite\nval newNames = Seq(\"GLOBALEVENTID\", \"SQLDATE\", \"ActionGeo_CountryCode\")\nval eventsDF_R1 = eventsDF.select(\"col_0\", \"col_1\", \"col_53\").toDF(newNames: _*)\neventsDF_R1.show()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+--------+---------------------+\n|GLOBALEVENTID| SQLDATE|ActionGeo_CountryCode|\n+-------------+--------+---------------------+\n|    890018526|20181201|                   UK|\n|    890018527|20181201|                   UK|\n|    890018528|20181201|                   UK|\n|    890018529|20181201|                   PK|\n|    890018530|20181201|                   AF|\n|    890018531|20181201|                   PK|\n|    890018532|20181201|                   AF|\n|    890018533|20181201|                   PK|\n|    890018534|20181201|                   PK|\n|    890018535|20181201|                   PK|\n|    890018536|20181201|                   PK|\n|    890018537|20191101|                   AS|\n|    890018538|20191101|                   AS|\n|    890018539|20191101|                   AS|\n|    890018540|20191101|                   AS|\n|    890018541|20191101|                   SY|\n|    890018542|20191101|                   SY|\n|    890018543|20191101|                   SY|\n|    890018544|20191124|                   UK|\n|    890018545|20191124|                   FR|\n+-------------+--------+---------------------+\nonly showing top 20 rows\n\nnewNames: Seq[String] = List(GLOBALEVENTID, SQLDATE, ActionGeo_CountryCode)\neventsDF_R1: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, SQLDATE: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1579860719661_-146006987","id":"20200121-113524_1714006000","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5649"},{"text":"%md\n## Chargement des mentions dans un dataframe","user":"anonymous","dateUpdated":"2020-01-24T10:20:26+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Chargement des mentions dans un dataframe</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1579860719662_-95319766","id":"20200123-083344_838531439","dateCreated":"2020-01-24T10:11:59+0000","dateStarted":"2020-01-24T10:20:26+0000","dateFinished":"2020-01-24T10:20:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5650"},{"text":"// Chargement dans un RDD\nval mentionsRDD = sc.binaryFiles(\"s3a://thomas-gdelt/data/201912[0-9]*.mentions.CSV.zip\").\n      flatMap { // decompresser les fichiers\n        case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n            takeWhile{ case null => zis.close(); false\n            case _ => true }.\n            flatMap { _ =>\n              val br = new BufferedReader(new InputStreamReader(zis))\n              Stream.continually(br.readLine()).takeWhile(_ != null)\n            }\n      }","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"mentionsRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[100] at flatMap at <console>:64\n"}]},"apps":[],"jobName":"paragraph_1579860719662_2076422444","id":"20200123-083403_1783229045","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5651"},{"text":"// Conversion du RDD en dataframe\nval arrays = mentionsRDD.map(_.split(\"\\t\")) \nval maxCols = 15//arrays.first().length\nval mentionsDF = arrays.toDF(\"arr\")\n  .select((0 until maxCols).map(i => $\"arr\"(i).as(s\"col_$i\")): _*)\n\nmentionsDF.show()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+--------------+--------------+-----+--------------------+--------------------+-----+-----+-----+-----+------+------+------+-----------------+------+\n|    col_0|         col_1|         col_2|col_3|               col_4|               col_5|col_6|col_7|col_8|col_9|col_10|col_11|col_12|           col_13|col_14|\n+---------+--------------+--------------+-----+--------------------+--------------------+-----+-----+-----+-----+------+------+------+-----------------+------+\n|806760880|20181201001500|20191201000000|    1|        theaggie.org|https://theaggie....|    5|   -1| 1332| 1344|     0|    20|  6319|-3.11111111111111|  null|\n|890018526|20191201000000|20191201000000|    1|           41nbc.com|https://41nbc.com...|    1|   -1|   33|   77|     0|    20|  3586|-8.74587458745875|  null|\n|806804320|20181201034500|20191201000000|    1|           41nbc.com|https://41nbc.com...|    1|   -1|   18|   52|     1|    80|  3586|-8.74587458745875|  null|\n|806786871|20181201020000|20191201000000|    1|           41nbc.com|https://41nbc.com...|    1|   -1|   18|   87|     1|   100|  3586|-8.74587458745875|  null|\n|890018527|20191201000000|20191201000000|    1|           41nbc.com|https://41nbc.com...|    3|  380|   -1|  457|     1|    60|  4026|-2.80898876404495|  null|\n|890018528|20191201000000|20191201000000|    1|           41nbc.com|https://41nbc.com...|    3|  380|  425|  461|     0|    40|  4026|-2.80898876404495|  null|\n|806763375|20181201000000|20191201000000|    1|        theaggie.org|https://theaggie....|    5| 1332|   -1| 1368|     0|    20|  6319|-3.11111111111111|  null|\n|806759545|20181201001500|20191201000000|    1|        theaggie.org|https://theaggie....|    5| 1332|   -1| 1344|     0|    20|  6319|-3.11111111111111|  null|\n|890018529|20191201000000|20191201000000|    1|warwickdailynews....|https://www.warwi...|   40| 9349| 9413| 9485|     0|    20|  9434|-7.36775818639798|  null|\n|890018529|20191201000000|20191201000000|    1| thechronicle.com.au|https://www.thech...|   40| 9349| 9413| 9485|     0|    20|  9434|-7.36775818639798|  null|\n|890018530|20191201000000|20191201000000|    1|warwickdailynews....|https://www.warwi...|   40| 9349| 9413| 9485|     0|    20|  9434|-7.36775818639798|  null|\n|890018530|20191201000000|20191201000000|    1| thechronicle.com.au|https://www.thech...|   40| 9349| 9413| 9485|     0|    20|  9434|-7.36775818639798|  null|\n|890018531|20191201000000|20191201000000|    1|warwickdailynews....|https://www.warwi...|   40| 9349| 9413| 9428|     0|    20|  9434|-7.36775818639798|  null|\n|890018531|20191201000000|20191201000000|    1| thechronicle.com.au|https://www.thech...|   40| 9349| 9413| 9428|     0|    20|  9434|-7.36775818639798|  null|\n|890018532|20191201000000|20191201000000|    1|warwickdailynews....|https://www.warwi...|   40| 9349| 9413| 9428|     0|    20|  9434|-7.36775818639798|  null|\n|890018532|20191201000000|20191201000000|    1| thechronicle.com.au|https://www.thech...|   40| 9349| 9413| 9428|     0|    20|  9434|-7.36775818639798|  null|\n|890018533|20191201000000|20191201000000|    1|warwickdailynews....|https://www.warwi...|   40| 9349| 9379| 9451|     0|    40|  9434|-7.36775818639798|  null|\n|890018533|20191201000000|20191201000000|    1| thechronicle.com.au|https://www.thech...|   40| 9349| 9379| 9451|     0|    40|  9434|-7.36775818639798|  null|\n|890018534|20191201000000|20191201000000|    1|warwickdailynews....|https://www.warwi...|   40| 9349| 9379| 9392|     0|    40|  9434|-7.36775818639798|  null|\n|890018534|20191201000000|20191201000000|    1| thechronicle.com.au|https://www.thech...|   40| 9349| 9379| 9392|     0|    40|  9434|-7.36775818639798|  null|\n+---------+--------------+--------------+-----+--------------------+--------------------+-----+-----+-----+-----+------+------+------+-----------------+------+\nonly showing top 20 rows\n\narrays: org.apache.spark.rdd.RDD[Array[String]] = MapPartitionsRDD[101] at map at <console>:66\nmaxCols: Int = 15\nmentionsDF: org.apache.spark.sql.DataFrame = [col_0: string, col_1: string ... 13 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719662_-1674688377","id":"20200123-083402_2056822854","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5652"},{"text":"mentionsDF.count()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res11: Long = 17252625\n"}]},"apps":[],"jobName":"paragraph_1579860719662_-813969689","id":"20200123-231743_1419746048","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5653"},{"text":"// Sélection des colonnes nécessaires pour la suite\nval newNames = Seq(\"GLOBALEVENTID\", \"MentionTimeDate\", \"MentionDocTranslationInfo\")\nval mentionsDF_R1 = mentionsDF.select(\"col_0\", \"col_2\", \"col_14\").toDF(newNames: _*)\nmentionsDF_R1.show()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+---------------+-------------------------+\n|GLOBALEVENTID|MentionTimeDate|MentionDocTranslationInfo|\n+-------------+---------------+-------------------------+\n|    806760880| 20191201000000|                     null|\n|    890018526| 20191201000000|                     null|\n|    806804320| 20191201000000|                     null|\n|    806786871| 20191201000000|                     null|\n|    890018527| 20191201000000|                     null|\n|    890018528| 20191201000000|                     null|\n|    806763375| 20191201000000|                     null|\n|    806759545| 20191201000000|                     null|\n|    890018529| 20191201000000|                     null|\n|    890018529| 20191201000000|                     null|\n|    890018530| 20191201000000|                     null|\n|    890018530| 20191201000000|                     null|\n|    890018531| 20191201000000|                     null|\n|    890018531| 20191201000000|                     null|\n|    890018532| 20191201000000|                     null|\n|    890018532| 20191201000000|                     null|\n|    890018533| 20191201000000|                     null|\n|    890018533| 20191201000000|                     null|\n|    890018534| 20191201000000|                     null|\n|    890018534| 20191201000000|                     null|\n+-------------+---------------+-------------------------+\nonly showing top 20 rows\n\nnewNames: Seq[String] = List(GLOBALEVENTID, MentionTimeDate, MentionDocTranslationInfo)\nmentionsDF_R1: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, MentionTimeDate: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1579860719662_-1883753667","id":"20200123-083402_1855321442","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5654"},{"text":"def extract_language(translationInfo:String ) : String = {\n    if (translationInfo == null)\n        return \"eng\"\n    else \n        return translationInfo.slice(6, 9)\n}\n\nval extract_language_udf = udf(extract_language _)\nval mentionsDF_cleaned_R1 = mentionsDF_R1.withColumn(\"MentionDocTranslationInfo\", extract_language_udf($\"MentionDocTranslationInfo\"))\nmentionsDF_cleaned_R1.show","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+---------------+-------------------------+\n|GLOBALEVENTID|MentionTimeDate|MentionDocTranslationInfo|\n+-------------+---------------+-------------------------+\n|    806760880| 20191201000000|                      eng|\n|    890018526| 20191201000000|                      eng|\n|    806804320| 20191201000000|                      eng|\n|    806786871| 20191201000000|                      eng|\n|    890018527| 20191201000000|                      eng|\n|    890018528| 20191201000000|                      eng|\n|    806763375| 20191201000000|                      eng|\n|    806759545| 20191201000000|                      eng|\n|    890018529| 20191201000000|                      eng|\n|    890018529| 20191201000000|                      eng|\n|    890018530| 20191201000000|                      eng|\n|    890018530| 20191201000000|                      eng|\n|    890018531| 20191201000000|                      eng|\n|    890018531| 20191201000000|                      eng|\n|    890018532| 20191201000000|                      eng|\n|    890018532| 20191201000000|                      eng|\n|    890018533| 20191201000000|                      eng|\n|    890018533| 20191201000000|                      eng|\n|    890018534| 20191201000000|                      eng|\n|    890018534| 20191201000000|                      eng|\n+-------------+---------------+-------------------------+\nonly showing top 20 rows\n\nextract_language: (translationInfo: String)String\nextract_language_udf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function1>,StringType,Some(List(StringType)))\nmentionsDF_cleaned_R1: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, MentionTimeDate: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1579860719662_476070541","id":"20200123-094817_1015566146","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5655"},{"text":"%md\n## Chargement de gkg dans un dataframe","user":"anonymous","dateUpdated":"2020-01-24T10:20:38+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Chargement de gkg dans un dataframe</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1579860719662_1776926492","id":"20200123-145938_1433594459","dateCreated":"2020-01-24T10:11:59+0000","dateStarted":"2020-01-24T10:20:38+0000","dateFinished":"2020-01-24T10:20:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5656"},{"text":"// Chargement dans un RDD\nval gkgRDD = sc.binaryFiles(\"s3a://thomas-gdelt/data/20181201[0-9]*.gkg.csv.zip\").\n      flatMap { // decompresser les fichiers\n        case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n            takeWhile{ case null => zis.close(); false\n            case _ => true }.\n            flatMap { _ =>\n              val br = new BufferedReader(new InputStreamReader(zis))\n              Stream.continually(br.readLine()).takeWhile(_ != null)\n            }\n      }","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"gkgRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[1] at flatMap at <console>:64\n"}]},"apps":[],"jobName":"paragraph_1579860719663_613232123","id":"20200123-150013_578125413","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5657"},{"text":"// Conversion du RDD en dataframe\nval arrays = gkgRDD.map(_.split(\"\\t\")) \nval maxCols = arrays.first().length\nval gkgDF = arrays.toDF(\"arr\")\n  .select((0 until maxCols).map(i => $\"arr\"(i).as(s\"col_$i\")): _*)\n\ngkgDF.show()\n","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------+--------------+-----+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------+--------------------+--------------------+--------------------+--------------------+\n|            col_0|         col_1|col_2|               col_3|               col_4|               col_5|               col_6|               col_7|               col_8|               col_9|              col_10|              col_11|              col_12|              col_13|              col_14|              col_15|              col_16|              col_17|              col_18|              col_19|col_20|              col_21|              col_22|              col_23|              col_24|\n+-----------------+--------------+-----+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------+--------------------+--------------------+--------------------+--------------------+\n| 20181201000000-0|20181201000000|    1|           nbc29.com|http://www.nbc29....|                    |                    |UNGP_FORESTS_RIVE...|TAX_WORLDLANGUAGE...|3#Fitchburg, Mass...|3#Fitchburg, Mass...|                    |                    |                    |                    |-3.125,1.04166666...|                    |wc:85,c12.1:2,c12...|https://WBBH.imag...|                    |      |                    |                    |                    |2,beavers waddlin...|\n| 20181201000000-1|20181201000000|    1|       theusnews.com|https://www.theus...|                    |                    |                    |                    |3#Chicago, Illino...|3#Chicago, Illino...|akiem hicks;benny...|Akiem Hicks,1174;...|       chicago bears|                    |-1.81818181818182...|                    |wc:200,c12.1:29,c...|https://cdn.bigne...|                    |      |https://youtube.c...|                    |Chicago Bears,18;...|230,yards,211;3,t...|\n| 20181201000000-2|20181201000000|    1|            wsar.com|http://wsar.com/n...|                    |                    |MANMADE_DISASTER_...|TAX_FNCACT_INSPEC...|                    |                    |las vega mccarran...|Las Vega Mccarran...|aviation administ...|Aviation Administ...|-1.16618075801749...|                    |wc:307,c12.1:10,c...|http://abcnewsrad...|                    |      |                    |                    |Getty Images,39;F...|166,passengers,1442;|\n| 20181201000000-3|20181201000000|    1|     wickedlocal.com|http://marion.wic...|  AFFECT#5##0######;|AFFECT#5##0#######0;|AFFECT;CRISISLEX_...|GENERAL_HEALTH,58...|                    |                    |                    |                    |greater lawrence ...|Greater Lawrence ...|5.83333333333333,...|                    |wc:100,c12.1:19,c...|http://marion.wic...|                    |      |                    |                    |Merrimack Valley,...|5,will host an al...|\n| 20181201000000-4|20181201000000|    1|    newwestrecord.ca|https://www.newwe...|                    |                    |TAX_FNCACT;TAX_FN...|GENERAL_GOVERNMEN...|1#Canada#CA#CA#60...|4#Quebec, Quebec,...|melissa burke;jas...|Melissa Burke,115...|      council office| Council Office,1129|-2.91666666666667...|                    |wc:447,c1.2:1,c12...|                    |                    |      |                    |                    |Jason Kenney,49;D...|                    |\n| 20181201000000-5|20181201000000|    1|            wrex.com|https://wrex.com/...|                    |                    |TAX_FNCACT;TAX_FN...|TAX_POLITICAL_PAR...|2#Kentucky, Unite...|2#Kentucky, Unite...|david osborne;dai...|David Osborne,698...|                    |                    |-6.76691729323308...|                    |wc:122,c12.1:5,c1...|                    |                    |      |                    |                    |House Republican ...|                null|\n| 20181201000000-6|20181201000000|    1|      maravipost.com|http://www.maravi...|                    |                    |ARREST;SOC_GENERA...|ECON_WORLDCURRENC...|2#Florida, United...|2#Florida, United...|shanetta yvette w...|Shanetta Yvette W...|broward county sh...|Yahoo,1435;Yahoo,...|-8.90688259109312...|                    |wc:236,c12.1:12,c...|http://www.maravi...|                    |      |                    |                    |Shanetta Yvette W...|    2,dollars ,1082;|\n| 20181201000000-7|20181201000000|    1|     wickedlocal.com|http://middleboro...|  AFFECT#5##0######;|AFFECT#5##0#######0;|AFFECT;CRISISLEX_...|GENERAL_HEALTH,58...|                    |                    |                    |                    |greater lawrence ...|Greater Lawrence ...|5.83333333333333,...|                    |wc:100,c12.1:19,c...|http://middleboro...|                    |      |                    |                    |Merrimack Valley,...|5,will host an al...|\n| 20181201000000-8|20181201000000|    1|therolladailynews...|https://www.thero...|PROTEST#8#gasolin...|PROTEST#8#gasolin...|USPEC_UNCERTAINTY...|KILL,3600;KILL,40...|4#Moscow, Moskva,...|1#Russia#RS#RS##6...|theresa may;angel...|Theresa May,5910;...|european council;...|European Council,...|-2.33863423760524...|     1#0#0#2001#6073|wc:995,c1.2:5,c1....|https://www.thero...|                    |      |                    |                    |Donald Trump,666;...|20,summit on fixi...|\n| 20181201000000-9|20181201000000|    1|     airdrieecho.com|https://www.airdr...|                    |                    |ECON_TAXATION;USP...|GENERAL_GOVERNMEN...|4#Saskatchewan, M...|4#Saskatchewan, M...|blaine higgs;eric...|Blaine Higgs,3103...|university of alb...|University Of Alb...|-5.61708860759494...|                    |wc:1175,c1.1:1,c1...|https://nationalp...|                    |      |                    |2448|46||It altog...|United Conservati...|5,provinces lined...|\n|20181201000000-10|20181201000000|    1|   actionnewsjax.com|https://www.actio...|                    |                    |USPEC_POLICY1;EPU...|EPU_CATS_MIGRATIO...|                    |                    |                    |                    |    terms of service|Terms Of Service,...|1.8348623853211,2...|                    |wc:304,c1.3:1,c12...|https://mediaweb....|                    |      |                    |                    |                    |                    |\n|20181201000000-11|20181201000000|    1|      prnewswire.com|https://www.prnew...|                    |                    |TAX_ECON_PRICE;EP...|TAX_ECON_PRICE,22...|4#London, London,...|4#London, London,...|        jason haynes|   Jason Haynes,1551|zfigs dungeon til...|Zfigs Dungeon Til...|0.766283524904215...|      1#0#0#1998#949|wc:205,c1.2:2,c12...|https://mma.prnew...|                    |      |https://youtube.c...|                    |Toy Vault,66;Zfig...|40,dollars for a ...|\n|20181201000000-12|20181201000000|    1| businessinsider.com|https://www.busin...|                    |                    |TAX_FNCACT;TAX_FN...|ELECTION,166;TAX_...|1#Russia#RS#RS#60...|1#Russian#RS#RS##...|felix sater;rober...|Felix Sater,12;Ro...|                    |                    |-1.96078431372549...|                    |wc:44,c12.10:4,c1...|https://amp.busin...|                    |      |https://youtube.c...|                    |Felix Sater,13;Ro...|                    |\n|20181201000000-13|20181201000000|    1| businessinsider.com|https://www.busin...|                    |                    |ENV_OIL;MOVEMENT_...|MEDIA_MSM,1694;TA...|2#Florida, United...|2#Delaware, Unite...|donna wieting;dia...|Donna Wieting,161...|schlumberger ltd;...|Schlumberger Ltd,...|-4.49172576832151...|       4#4#30#0#1950|wc:395,c1.2:1,c1....|https://amp.busin...|                    |      |https://youtube.c...|                    |National Oceanic,...|5,companies initi...|\n|20181201000000-14|20181201000000|    1|geelongadvertiser...|https://www.geelo...|                    |                    |KILL;CRISISLEX_T0...|AFFECT,1060;KILL,...|                    |                    |doris roberts;ray...|Doris Roberts,156...|                    |                    |3.00429184549356,...|1#0#0#2006#344;1#...|wc:199,c12.1:19,c...|https://cdn.newsa...|https://cdn.newsa...|      |                    |860|124||It would...|Patricia Heaton,1...|                    |\n|20181201000000-15|20181201000000|    1|    theparisnews.com|http://theparisne...|                    |                    |NATURAL_DISASTER;...|UNGP_FORESTS_RIVE...|                    |                    |       quincy blount|   Quincy Blount,190|national weather ...|National Weather ...|0,3.1746031746031...|                    |wc:119,c12.1:10,c...|https://bloximage...|                    |      |                    |                    |Lamar County,13;N...|                    |\n|20181201000000-16|20181201000000|    1|    timminstimes.com|https://www.timmi...|                    |                    |ECON_TAXATION;USP...|GENERAL_GOVERNMEN...|4#Saskatchewan, M...|4#Saskatchewan, M...|blaine higgs;eric...|Blaine Higgs,3103...|university of alb...|University Of Alb...|-5.61708860759494...|                    |wc:1175,c1.1:1,c1...|https://nationalp...|                    |      |                    |2448|46||It altog...|United Conservati...|5,provinces lined...|\n|20181201000000-17|20181201000000|    1|          wsoctv.com|https://www.wsoct...|                    |                    |USPEC_POLICY1;EPU...|EPU_CATS_MIGRATIO...|                    |                    |                    |                    |    terms of service|Terms Of Service,...|1.8348623853211,2...|                    |wc:304,c1.3:1,c12...|https://mediaweb....|                    |      |                    |                    |                    |                    |\n|20181201000000-18|20181201000000|    1|           radio.com|https://971thetic...|                    |                    |                    |                    |                    |                    |reggie bush;mathe...|Reggie Bush,2371;...|                    |                    |-0.49115913555992...|1#0#0#2014#842;1#...|wc:870,c1.3:2,c12...|https://s3.us-eas...|                    |      |https://youtube.c...|                    |Matthew Stafford,...|1,The Ticket,449;...|\n|20181201000000-19|20181201000000|    1|          whas11.com|https://www.whas1...|                    |                    |WB_696_PUBLIC_SEC...|EPU_POLICY_FEDERA...|1#China#CH#CH#35#...|1#Argentina#AR#AR...|jerome powell;don...|Jerome Powell,236...|google;american a...|Google,897;Americ...|-2.59842519685039...|      1#0#0#1990#775|wc:1118,c1.2:6,c1...|https://www.whas1...|                    |      |                    |2834|97||remain j...|Deutsche Bank,501...|2,corrections #x2...|\n+-----------------+--------------+-----+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+------+--------------------+--------------------+--------------------+--------------------+\nonly showing top 20 rows\n\narrays: org.apache.spark.rdd.RDD[Array[String]] = MapPartitionsRDD[2] at map at <console>:63\nmaxCols: Int = 25\ngkgDF: org.apache.spark.sql.DataFrame = [col_0: string, col_1: string ... 23 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719663_-597391496","id":"20200123-150012_1318971880","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5658"},{"text":"// Sélection des colonnes nécessaires pour la suite\nval newNames = Seq(\"GKGRECORDID\", \"date\", \"SourceCommonName\", \"v2locations\", \"themes\", \"v2tone\", \"Persons\")\nval gkgDF_R3 = gkgDF.select(\"col_0\", \"col_1\", \"col_3\", \"col_10\", \"col_7\", \"col_15\", \"col_11\").toDF(newNames: _*)\ngkgDF_R3.show()\n","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------+--------------+--------------------+--------------------+--------------------+--------------------+--------------------+\n|      GKGRECORDID|          date|    SourceCommonName|         v2locations|              themes|              v2tone|             Persons|\n+-----------------+--------------+--------------------+--------------------+--------------------+--------------------+--------------------+\n| 20181201000000-0|20181201000000|           nbc29.com|3#Fitchburg, Mass...|UNGP_FORESTS_RIVE...|-3.125,1.04166666...|                    |\n| 20181201000000-1|20181201000000|       theusnews.com|3#Chicago, Illino...|                    |-1.81818181818182...|akiem hicks;benny...|\n| 20181201000000-2|20181201000000|            wsar.com|                    |MANMADE_DISASTER_...|-1.16618075801749...|las vega mccarran...|\n| 20181201000000-3|20181201000000|     wickedlocal.com|                    |AFFECT;CRISISLEX_...|5.83333333333333,...|                    |\n| 20181201000000-4|20181201000000|    newwestrecord.ca|4#Quebec, Quebec,...|TAX_FNCACT;TAX_FN...|-2.91666666666667...|melissa burke;jas...|\n| 20181201000000-5|20181201000000|            wrex.com|2#Kentucky, Unite...|TAX_FNCACT;TAX_FN...|-6.76691729323308...|david osborne;dai...|\n| 20181201000000-6|20181201000000|      maravipost.com|2#Florida, United...|ARREST;SOC_GENERA...|-8.90688259109312...|shanetta yvette w...|\n| 20181201000000-7|20181201000000|     wickedlocal.com|                    |AFFECT;CRISISLEX_...|5.83333333333333,...|                    |\n| 20181201000000-8|20181201000000|therolladailynews...|1#Russia#RS#RS##6...|USPEC_UNCERTAINTY...|-2.33863423760524...|theresa may;angel...|\n| 20181201000000-9|20181201000000|     airdrieecho.com|4#Saskatchewan, M...|ECON_TAXATION;USP...|-5.61708860759494...|blaine higgs;eric...|\n|20181201000000-10|20181201000000|   actionnewsjax.com|                    |USPEC_POLICY1;EPU...|1.8348623853211,2...|                    |\n|20181201000000-11|20181201000000|      prnewswire.com|4#London, London,...|TAX_ECON_PRICE;EP...|0.766283524904215...|        jason haynes|\n|20181201000000-12|20181201000000| businessinsider.com|1#Russian#RS#RS##...|TAX_FNCACT;TAX_FN...|-1.96078431372549...|felix sater;rober...|\n|20181201000000-13|20181201000000| businessinsider.com|2#Delaware, Unite...|ENV_OIL;MOVEMENT_...|-4.49172576832151...|donna wieting;dia...|\n|20181201000000-14|20181201000000|geelongadvertiser...|                    |KILL;CRISISLEX_T0...|3.00429184549356,...|doris roberts;ray...|\n|20181201000000-15|20181201000000|    theparisnews.com|                    |NATURAL_DISASTER;...|0,3.1746031746031...|       quincy blount|\n|20181201000000-16|20181201000000|    timminstimes.com|4#Saskatchewan, M...|ECON_TAXATION;USP...|-5.61708860759494...|blaine higgs;eric...|\n|20181201000000-17|20181201000000|          wsoctv.com|                    |USPEC_POLICY1;EPU...|1.8348623853211,2...|                    |\n|20181201000000-18|20181201000000|           radio.com|                    |                    |-0.49115913555992...|reggie bush;mathe...|\n|20181201000000-19|20181201000000|          whas11.com|1#Argentina#AR#AR...|WB_696_PUBLIC_SEC...|-2.59842519685039...|jerome powell;don...|\n+-----------------+--------------+--------------------+--------------------+--------------------+--------------------+--------------------+\nonly showing top 20 rows\n\nnewNames: Seq[String] = List(GKGRECORDID, date, SourceCommonName, v2locations, themes, v2tone, Persons)\ngkgDF_R3: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, date: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719663_-979634718","id":"20200123-150011_847294037","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5659"},{"text":"%md \n# Préparation et écriture des dataframes dans Cassandra","user":"anonymous","dateUpdated":"2020-01-24T10:23:28+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Préparation et écriture des dataframes dans Cassandra</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1579861370204_-390721338","id":"20200124-102250_1281399648","dateCreated":"2020-01-24T10:22:50+0000","dateStarted":"2020-01-24T10:23:28+0000","dateFinished":"2020-01-24T10:23:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5660"},{"text":"def compute_month(date:String) : String = {\n    if (date.length > 6)\n        return date.slice(0,6)\n    else\n        return \"\"\n}\nval compute_month_udf = udf(compute_month _)\ndef compute_year(date:String) : String = {\n        if (date.length > 4)\n        return date.slice(0,4)\n    else\n        return \"\"\n}\nval compute_year_udf = udf(compute_year _)","user":"anonymous","dateUpdated":"2020-01-24T10:29:39+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"compute_month: (date: String)String\ncompute_month_udf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function1>,StringType,Some(List(StringType)))\ncompute_year: (date: String)String\ncompute_year_udf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function1>,StringType,Some(List(StringType)))\n"}]},"apps":[],"jobName":"paragraph_1579861774734_-403552038","id":"20200124-102934_1949531022","dateCreated":"2020-01-24T10:29:34+0000","dateStarted":"2020-01-24T10:29:39+0000","dateFinished":"2020-01-24T10:29:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5661"},{"text":"%md\n## Requête 1","user":"anonymous","dateUpdated":"2020-01-24T10:25:03+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Requête 1</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1579860719663_1054974660","id":"20200123-100434_1425310306","dateCreated":"2020-01-24T10:11:59+0000","dateStarted":"2020-01-24T10:25:03+0000","dateFinished":"2020-01-24T10:25:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5662"},{"text":"val R1_df = eventsDF_R1.join(mentionsDF_cleaned_R1, Seq(\"GLOBALEVENTID\"))\nR1_df.show","user":"anonymous","dateUpdated":"2020-01-24T10:25:22+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"<console>:61: error: not found: value eventsDF_R1\n       val R1_df = eventsDF_R1.join(mentionsDF_cleaned_R1, Seq(\"GLOBALEVENTID\"))\n                   ^\n<console>:61: error: not found: value mentionsDF_cleaned_R1\n       val R1_df = eventsDF_R1.join(mentionsDF_cleaned_R1, Seq(\"GLOBALEVENTID\"))\n                                    ^\n"}]},"apps":[],"jobName":"paragraph_1579860719663_1210225283","id":"20200123-100451_1855108384","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5663"},{"text":"R1_df.cache","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res131: R1_df.type = [GLOBALEVENTID: string, SQLDATE: string ... 3 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719664_676455897","id":"20200123-132511_1828933955","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5664"},{"text":"R1_df.select(\"GLOBALEVENTID\", \"SQLDATE\", \"ActionGeo_CountryCode\", \"MentionDocTranslationInfo\")\nR1_df.show()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+--------+---------------------+---------------+-------------------------+\n|GLOBALEVENTID| SQLDATE|ActionGeo_CountryCode|MentionTimeDate|MentionDocTranslationInfo|\n+-------------+--------+---------------------+---------------+-------------------------+\n|    890018679|20191201|                   RS| 20191201000000|                      eng|\n|    890018770|20191201|                   AU| 20191201000000|                      eng|\n|    890018998|20191201|                   US| 20191201000000|                      eng|\n|    890018998|20191201|                   US| 20191201001500|                      eng|\n|    890019018|20191201|                   US| 20191201000000|                      eng|\n|    890019265|20191201|                   JE| 20191201000000|                      eng|\n|    890019391|20191201|                   UK| 20191201000000|                      eng|\n|    890019391|20191201|                   UK| 20191201004500|                      eng|\n|    890019391|20191201|                   UK| 20191201004500|                      eng|\n|    890019391|20191201|                   UK| 20191201010000|                      eng|\n|    890019391|20191201|                   UK| 20191201140000|                      eng|\n|    890019391|20191201|                   UK| 20191201144500|                      eng|\n|    890019391|20191201|                   UK| 20191201144500|                      eng|\n|    890019391|20191201|                   UK| 20191201153000|                      eng|\n|    890019391|20191201|                   UK| 20191201154500|                      eng|\n|    890019391|20191201|                   UK| 20191201160000|                      eng|\n|    890019391|20191201|                   UK| 20191201173000|                      eng|\n|    890019391|20191201|                   UK| 20191201173000|                      eng|\n|    890019391|20191201|                   UK| 20191201213000|                      eng|\n|    890019391|20191201|                   UK| 20191201213000|                      eng|\n+-------------+--------+---------------------+---------------+-------------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1579860719664_1745876412","id":"20200123-101156_763864352","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5665"},{"text":"val R1_grouped_df = R1_df.groupBy(\"GLOBALEVENTID\", \"SQLDATE\",\"ActionGeo_CountryCode\",\"MentionDocTranslationInfo\").count().sort(desc(\"count\"))\nR1_grouped_df.show()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+--------+---------------------+-------------------------+-----+\n|GLOBALEVENTID| SQLDATE|ActionGeo_CountryCode|MentionDocTranslationInfo|count|\n+-------------+--------+---------------------+-------------------------+-----+\n|    893865270|20191219|                   US|                      eng| 1429|\n|    895587658|20191229|                   US|                      eng| 1098|\n|    895561048|20191229|                   US|                      eng| 1061|\n|    891896509|20191210|                   US|                      eng| 1048|\n|    893888028|20191219|                   US|                      eng| 1046|\n|    893864738|20191219|                   US|                      eng| 1011|\n|    890626831|20191204|                   UP|                      eng|  990|\n|    890891782|20191205|                   US|                      eng|  976|\n|    890927396|20191205|                   US|                      eng|  975|\n|    892651682|20191213|                   CH|                      eng|  941|\n|    895865342|20191231|                   US|                      eng|  939|\n|    893622243|20191218|                   US|                      eng|  917|\n|    895871604|20191231|                   JA|                      eng|  892|\n|    890893713|20191205|                   US|                      eng|  872|\n|    893888814|20191219|                   US|                      eng|  865|\n|    895293122|20191227|                   KZ|                      eng|  861|\n|    891895678|20191210|                   UP|                      eng|  859|\n|    890891290|20191205|                   US|                      eng|  858|\n|    894614731|20191223|                   US|                      eng|  834|\n|    894613636|20191223|                   US|                      eng|  824|\n+-------------+--------+---------------------+-------------------------+-----+\nonly showing top 20 rows\n\nR1_grouped_df: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [GLOBALEVENTID: string, SQLDATE: string ... 3 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719664_2010767975","id":"20200123-101821_728566242","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5666"},{"text":"val newNames = Seq(\"globaleventid\", \"sqldate\", \"actiongeo_countrycode\", \"mentiondoctranslationinfo\", \"count\")\nval R1_final_df = R1_grouped_df.toDF(newNames: _*)\nprintln(R1_final_df.count())\nR1_final_df.show()","user":"anonymous","dateUpdated":"2020-01-24T10:28:00+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+--------+---------------------+-------------------------+-----+\n|globaleventid| sqldate|actiongeo_countrycode|mentiondoctranslationinfo|count|\n+-------------+--------+---------------------+-------------------------+-----+\n|    893865270|20191219|                   US|                      eng| 1429|\n|    895587658|20191229|                   US|                      eng| 1098|\n|    895561048|20191229|                   US|                      eng| 1061|\n|    891896509|20191210|                   US|                      eng| 1048|\n|    893888028|20191219|                   US|                      eng| 1046|\n|    893864738|20191219|                   US|                      eng| 1011|\n|    890626831|20191204|                   UP|                      eng|  990|\n|    890891782|20191205|                   US|                      eng|  976|\n|    890927396|20191205|                   US|                      eng|  975|\n|    892651682|20191213|                   CH|                      eng|  941|\n|    895865342|20191231|                   US|                      eng|  939|\n|    893622243|20191218|                   US|                      eng|  917|\n|    895871604|20191231|                   JA|                      eng|  892|\n|    890893713|20191205|                   US|                      eng|  872|\n|    893888814|20191219|                   US|                      eng|  865|\n|    895293122|20191227|                   KZ|                      eng|  861|\n|    891895678|20191210|                   UP|                      eng|  859|\n|    890891290|20191205|                   US|                      eng|  858|\n|    894614731|20191223|                   US|                      eng|  834|\n|    894613636|20191223|                   US|                      eng|  824|\n+-------------+--------+---------------------+-------------------------+-----+\nonly showing top 20 rows\n\nnewNames: Seq[String] = List(globaleventid, sqldate, actiongeo_countrycode, mentiondoctranslationinfo, count)\nR1_final_df: org.apache.spark.sql.DataFrame = [globaleventid: string, sqldate: string ... 3 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719664_-1716546913","id":"20200123-104220_1349173695","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5667"},{"text":"%md\r\nCREATE TABLE R1 (GLOBALEVENTID int, SQLDATE int, ActionGeo_CountryCode text, MentionDocTranslationInfo text, count int, PRIMARY KEY (GLOBALEVENTID, MentionDocTranslationInfo));","user":"anonymous","dateUpdated":"2020-01-24T10:28:14+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719665_2055549329","id":"20200123-102924_16276009","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5668"},{"text":"R1_final_df.write\n  .cassandraFormat(\"r1\", \"gdelt_space\")\n  .mode(\"overwrite\")\n  .option(\"confirm.truncate\",\"true\")\n  .save()","user":"anonymous","dateUpdated":"2020-01-24T10:28:20+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1579860719665_-1561384828","id":"20200122-164028_535186367","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5669"},{"text":"%md\n## Requête 2","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Requête 2</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1579860719666_-1570327701","id":"20200123-133807_2742032","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5670"},{"text":"%md\nUSE gdelt_space;\nCREATE TABLE r2 (globaleventid int PRIMARY KEY, sqldate int, monthyear int, year int, actiongeo_countrycode text, nummentions int);","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719666_35368123","id":"20200123-140456_1504215756","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5671"},{"text":"// Sélection des colonnes nécessaires pour la suite\nval newNames = Seq(\"globaleventid\", \"sqldate\", \"monthyear\", \"year\", \"actiongeo_countrycode\", \"nummentions\")\nval eventsDF_R2 = eventsDF.select(\"col_0\", \"col_1\", \"col_2\", \"col_3\", \"col_53\", \"col_31\").toDF(newNames: _*)\nprintln(eventsDF_R2.count())\neventsDF_R2.show()","user":"anonymous","dateUpdated":"2020-01-24T10:28:56+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+--------+---------+----+---------------------+-----------+\n|globaleventid| sqldate|monthyear|year|actiongeo_countrycode|nummentions|\n+-------------+--------+---------+----+---------------------+-----------+\n|    890018526|20181201|   201812|2018|                   UK|          2|\n|    890018527|20181201|   201812|2018|                   UK|          6|\n|    890018528|20181201|   201812|2018|                   UK|          4|\n|    890018529|20181201|   201812|2018|                   PK|          4|\n|    890018530|20181201|   201812|2018|                   AF|          4|\n|    890018531|20181201|   201812|2018|                   PK|          4|\n|    890018532|20181201|   201812|2018|                   AF|          4|\n|    890018533|20181201|   201812|2018|                   PK|          8|\n|    890018534|20181201|   201812|2018|                   PK|          8|\n|    890018535|20181201|   201812|2018|                   PK|          4|\n|    890018536|20181201|   201812|2018|                   PK|          4|\n|    890018537|20191101|   201911|2019|                   AS|          8|\n|    890018538|20191101|   201911|2019|                   AS|          8|\n|    890018539|20191101|   201911|2019|                   AS|          2|\n|    890018540|20191101|   201911|2019|                   AS|          2|\n|    890018541|20191101|   201911|2019|                   SY|          2|\n|    890018542|20191101|   201911|2019|                   SY|          2|\n|    890018543|20191101|   201911|2019|                   SY|          6|\n|    890018544|20191124|   201911|2019|                   UK|          4|\n|    890018545|20191124|   201911|2019|                   FR|         16|\n+-------------+--------+---------+----+---------------------+-----------+\nonly showing top 20 rows\n\nnewNames: Seq[String] = List(globaleventid, sqldate, monthyear, year, actiongeo_countrycode, nummentions)\neventsDF_R2: org.apache.spark.sql.DataFrame = [globaleventid: string, sqldate: string ... 4 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719667_-627727483","id":"20200121-114335_827760728","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5672"},{"text":"eventsDF_R2.write\n  .cassandraFormat(\"r2\", \"gdelt_space\")\n  .mode(\"overwrite\")\n  .option(\"confirm.truncate\",\"true\")\n  .save()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1579860719667_1159915120","id":"20200120-215823_1585378542","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5673"},{"text":"%md\n## Requête 3","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Requête 3</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1579860719668_1697301254","id":"20200123-104906_2133221564","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5674"},{"text":"%md\n### Themes","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Themes</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1579860719668_-1162037349","id":"20200124-085341_1469583041","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5675"},{"text":"def split_tone(tone:String ) : Float = {\n    val res = tone split ',' take 1\n    return res(0).toFloat\n}\nval split_tone_udf = udf(split_tone _)","user":"anonymous","dateUpdated":"2020-01-24T10:31:20+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"split_tone: (tone: String)Float\nsplit_tone_udf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function1>,FloatType,Some(List(StringType)))\ncompute_month: (date: String)String\ncompute_month_udf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function1>,StringType,Some(List(StringType)))\ncompute_year: (date: String)String\ncompute_year_udf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function1>,StringType,Some(List(StringType)))\n"}]},"apps":[],"jobName":"paragraph_1579860719669_1892426390","id":"20200124-081505_1983945355","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5676"},{"text":"val gkgDF_R3_cleaned = gkgDF_R3.na.drop().withColumn(\"themes2\",split(regexp_replace($\"themes\", \"(^\\\\[\\\\[\\\\[)|(\\\\]\\\\]\\\\]$)\", \"\"), \";\")).withColumn(\"v2tone2\", split_tone_udf($\"v2tone\")).drop(\"themes\", \"v2tone\")\ngkgDF_R3_cleaned.show()","user":"anonymous","dateUpdated":"2020-01-24T10:31:23+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------+--------------+--------------------+--------------------+--------------------+--------------------+-----------+\n|      GKGRECORDID|          date|    SourceCommonName|         v2locations|             Persons|             themes2|    v2tone2|\n+-----------------+--------------+--------------------+--------------------+--------------------+--------------------+-----------+\n| 20181201000000-0|20181201000000|           nbc29.com|3#Fitchburg, Mass...|                    |[UNGP_FORESTS_RIV...|     -3.125|\n| 20181201000000-1|20181201000000|       theusnews.com|3#Chicago, Illino...|akiem hicks;benny...|                  []| -1.8181819|\n| 20181201000000-2|20181201000000|            wsar.com|                    |las vega mccarran...|[MANMADE_DISASTER...| -1.1661807|\n| 20181201000000-3|20181201000000|     wickedlocal.com|                    |                    |[AFFECT, CRISISLE...|  5.8333335|\n| 20181201000000-4|20181201000000|    newwestrecord.ca|4#Quebec, Quebec,...|melissa burke;jas...|[TAX_FNCACT, TAX_...| -2.9166667|\n| 20181201000000-5|20181201000000|            wrex.com|2#Kentucky, Unite...|david osborne;dai...|[TAX_FNCACT, TAX_...|  -6.766917|\n| 20181201000000-6|20181201000000|      maravipost.com|2#Florida, United...|shanetta yvette w...|[ARREST, SOC_GENE...|  -8.906882|\n| 20181201000000-7|20181201000000|     wickedlocal.com|                    |                    |[AFFECT, CRISISLE...|  5.8333335|\n| 20181201000000-8|20181201000000|therolladailynews...|1#Russia#RS#RS##6...|theresa may;angel...|[USPEC_UNCERTAINT...| -2.3386343|\n| 20181201000000-9|20181201000000|     airdrieecho.com|4#Saskatchewan, M...|blaine higgs;eric...|[ECON_TAXATION, U...|  -5.617089|\n|20181201000000-10|20181201000000|   actionnewsjax.com|                    |                    |[USPEC_POLICY1, E...|  1.8348624|\n|20181201000000-11|20181201000000|      prnewswire.com|4#London, London,...|        jason haynes|[TAX_ECON_PRICE, ...|  0.7662835|\n|20181201000000-12|20181201000000| businessinsider.com|1#Russian#RS#RS##...|felix sater;rober...|[TAX_FNCACT, TAX_...| -1.9607843|\n|20181201000000-13|20181201000000| businessinsider.com|2#Delaware, Unite...|donna wieting;dia...|[ENV_OIL, MOVEMEN...|  -4.491726|\n|20181201000000-14|20181201000000|geelongadvertiser...|                    |doris roberts;ray...|[KILL, CRISISLEX_...|  3.0042918|\n|20181201000000-15|20181201000000|    theparisnews.com|                    |       quincy blount|[NATURAL_DISASTER...|        0.0|\n|20181201000000-16|20181201000000|    timminstimes.com|4#Saskatchewan, M...|blaine higgs;eric...|[ECON_TAXATION, U...|  -5.617089|\n|20181201000000-17|20181201000000|          wsoctv.com|                    |                    |[USPEC_POLICY1, E...|  1.8348624|\n|20181201000000-18|20181201000000|           radio.com|                    |reggie bush;mathe...|                  []|-0.49115914|\n|20181201000000-19|20181201000000|          whas11.com|1#Argentina#AR#AR...|jerome powell;don...|[WB_696_PUBLIC_SE...| -2.5984251|\n+-----------------+--------------+--------------------+--------------------+--------------------+--------------------+-----------+\nonly showing top 20 rows\n\ngkgDF_R3_cleaned: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, date: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719669_-812237296","id":"20200123-144034_1649556300","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5677"},{"text":"val gkgDF_R3_themes = gkgDF_R3_cleaned.withColumn(\"date2\", $\"date\".cast(StringType)).withColumn(\"monthyear\", compute_month_udf($\"date\")).withColumn(\"year\", compute_year_udf($\"date\")).withColumn(\"v2tone3\", $\"v2tone2\".cast(FloatType)).drop(\"date\", \"v2tone2\", \"v2locations\", \"Persons\")\r\ngkgDF_R3_themes.show()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------+--------------------+--------------------+--------------+---------+----+-----------+\n|      GKGRECORDID|    SourceCommonName|             themes2|         date2|monthyear|year|    v2tone3|\n+-----------------+--------------------+--------------------+--------------+---------+----+-----------+\n| 20181201000000-0|           nbc29.com|[UNGP_FORESTS_RIV...|20181201000000|   201812|2018|     -3.125|\n| 20181201000000-1|       theusnews.com|                  []|20181201000000|   201812|2018| -1.8181819|\n| 20181201000000-2|            wsar.com|[MANMADE_DISASTER...|20181201000000|   201812|2018| -1.1661807|\n| 20181201000000-3|     wickedlocal.com|[AFFECT, CRISISLE...|20181201000000|   201812|2018|  5.8333335|\n| 20181201000000-4|    newwestrecord.ca|[TAX_FNCACT, TAX_...|20181201000000|   201812|2018| -2.9166667|\n| 20181201000000-5|            wrex.com|[TAX_FNCACT, TAX_...|20181201000000|   201812|2018|  -6.766917|\n| 20181201000000-6|      maravipost.com|[ARREST, SOC_GENE...|20181201000000|   201812|2018|  -8.906882|\n| 20181201000000-7|     wickedlocal.com|[AFFECT, CRISISLE...|20181201000000|   201812|2018|  5.8333335|\n| 20181201000000-8|therolladailynews...|[USPEC_UNCERTAINT...|20181201000000|   201812|2018| -2.3386343|\n| 20181201000000-9|     airdrieecho.com|[ECON_TAXATION, U...|20181201000000|   201812|2018|  -5.617089|\n|20181201000000-10|   actionnewsjax.com|[USPEC_POLICY1, E...|20181201000000|   201812|2018|  1.8348624|\n|20181201000000-11|      prnewswire.com|[TAX_ECON_PRICE, ...|20181201000000|   201812|2018|  0.7662835|\n|20181201000000-12| businessinsider.com|[TAX_FNCACT, TAX_...|20181201000000|   201812|2018| -1.9607843|\n|20181201000000-13| businessinsider.com|[ENV_OIL, MOVEMEN...|20181201000000|   201812|2018|  -4.491726|\n|20181201000000-14|geelongadvertiser...|[KILL, CRISISLEX_...|20181201000000|   201812|2018|  3.0042918|\n|20181201000000-15|    theparisnews.com|[NATURAL_DISASTER...|20181201000000|   201812|2018|        0.0|\n|20181201000000-16|    timminstimes.com|[ECON_TAXATION, U...|20181201000000|   201812|2018|  -5.617089|\n|20181201000000-17|          wsoctv.com|[USPEC_POLICY1, E...|20181201000000|   201812|2018|  1.8348624|\n|20181201000000-18|           radio.com|                  []|20181201000000|   201812|2018|-0.49115914|\n|20181201000000-19|          whas11.com|[WB_696_PUBLIC_SE...|20181201000000|   201812|2018| -2.5984251|\n+-----------------+--------------------+--------------------+--------------+---------+----+-----------+\nonly showing top 20 rows\n\nimport org.apache.spark.sql.types.StringType\nimport org.apache.spark.sql.types.FloatType\ncompute_month: (date: String)String\ncompute_month_udf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function1>,StringType,Some(List(StringType)))\ncompute_year: (date: String)String\ncompute_year_udf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function1>,StringType,Some(List(StringType)))\ngkgDF_R3_themes: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, SourceCommonName: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719669_-695093282","id":"20200123-171603_1286137837","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5678"},{"text":"val gkgDF_R3_themes2 = gkgDF_R3_themes.withColumn(\"themes3\", explode($\"themes2\")).drop(\"themes2\")\ngkgDF_R3_themes2.show()","user":"anonymous","dateUpdated":"2020-01-24T10:31:29+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------------+----------------+--------------+---------+----+----------+--------------------+\n|     GKGRECORDID|SourceCommonName|         date2|monthyear|year|   v2tone3|             themes3|\n+----------------+----------------+--------------+---------+----+----------+--------------------+\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|UNGP_FORESTS_RIVE...|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|  TAX_WORLDLANGUAGES|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|TAX_WORLDLANGUAGE...|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|        SURVEILLANCE|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|          TAX_FNCACT|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|  TAX_FNCACT_CASHIER|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|TAX_FNCACT_COMPANION|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|                    |\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|                    |\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|MANMADE_DISASTER_...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|          TAX_FNCACT|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|   TAX_FNCACT_PILOTS|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|SOC_POINTSOFINTEREST|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|SOC_POINTSOFINTER...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|    WB_135_TRANSPORT|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|WB_1803_TRANSPORT...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|    WB_1804_AIRPORTS|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|TAX_FNCACT_ATTEND...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|TAX_FNCACT_FLIGHT...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|      TAX_FNCACT_MAN|\n+----------------+----------------+--------------+---------+----+----------+--------------------+\nonly showing top 20 rows\n\ngkgDF_R3_themes2: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, SourceCommonName: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719669_1803808936","id":"20200123-160102_209712050","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5679"},{"text":"val newNames = Seq(\"gkgrecordid\", \"sourcecommonname\", \"date\", \"monthyear\", \"year\", \"tone\", \"themes\")\nval gkgDF_R3_themes_final = gkgDF_R3_themes2.toDF(newNames: _*)\nprintln(gkgDF_R3_themes_final.count())\ngkgDF_R3_themes_final.show(100)","user":"anonymous","dateUpdated":"2020-01-24T10:31:37+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------------+----------------+--------------+---------+----+----------+--------------------+\n|     gkgrecordid|sourcecommonname|          date|monthyear|year|      tone|              themes|\n+----------------+----------------+--------------+---------+----+----------+--------------------+\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|UNGP_FORESTS_RIVE...|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|  TAX_WORLDLANGUAGES|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|TAX_WORLDLANGUAGE...|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|        SURVEILLANCE|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|          TAX_FNCACT|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|  TAX_FNCACT_CASHIER|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|TAX_FNCACT_COMPANION|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|                    |\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|                    |\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|MANMADE_DISASTER_...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|          TAX_FNCACT|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|   TAX_FNCACT_PILOTS|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|SOC_POINTSOFINTEREST|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|SOC_POINTSOFINTER...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|    WB_135_TRANSPORT|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|WB_1803_TRANSPORT...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|    WB_1804_AIRPORTS|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|TAX_FNCACT_ATTEND...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|TAX_FNCACT_FLIGHT...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|      TAX_FNCACT_MAN|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|    TAX_FNCACT_PILOT|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|CRISISLEX_T11_UPD...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|CRISISLEX_CRISISL...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|   AVIATION_INCIDENT|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|    MANMADE_DISASTER|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|MANMADE_DISASTER_...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|               WOUND|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|CRISISLEX_C03_WEL...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|CRISISLEX_T02_INJ...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|WB_165_AIR_TRANSPORT|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|WB_164_MODES_OF_T...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|SOC_USSECURITYAGE...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|TAX_FNCACT_INSPECTOR|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807| EPU_CATS_REGULATION|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|                    |\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|              AFFECT|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|CRISISLEX_CRISISL...|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|SELF_IDENTIFIED_H...|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|CRISISLEX_O02_RES...|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|CRISISLEX_T06_SUP...|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|CRISISLEX_T07_SER...|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335| CRISISLEX_T05_MONEY|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|         GEN_HOLIDAY|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|      GENERAL_HEALTH|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|             MEDICAL|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|    WB_1406_DISEASES|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|WB_621_HEALTH_NUT...|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|WB_1430_MENTAL_HE...|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|WB_1427_NON_COMMU...|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|WB_1305_HEALTH_SE...|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|                    |\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|          TAX_FNCACT|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667| TAX_FNCACT_MINISTER|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|  GENERAL_GOVERNMENT|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|          EPU_POLICY|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|EPU_POLICY_GOVERN...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|            MARITIME|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|            MILITARY|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|     TAX_FNCACT_NAVY|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|   TAX_FNCACT_LEADER|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|TAX_FNCACT_MINISTERS|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|EPU_POLICY_POLITICAL|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|       TAX_ETHNICITY|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|TAX_ETHNICITY_CAN...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|  TAX_FNCACT_SERVANT|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|TAX_FNCACT_CIVIL_...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|  TAX_FNCACT_ANALYST|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|               TRIAL|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|CRISISLEX_C04_LOG...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|  TAX_FNCACT_LAWYERS|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        WB_2670_JOBS|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|WB_1467_EDUCATION...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|    WB_470_EDUCATION|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|WB_2131_EMPLOYABI...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|WB_1484_EDUCATION...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|   SECURITY_SERVICES|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|   TAX_FNCACT_POLICE|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|CRISISLEX_C07_SAFETY|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        NEGOTIATIONS|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|WB_696_PUBLIC_SEC...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|      WB_840_JUSTICE|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|WB_2473_DIPLOMACY...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|  WB_939_NEGOTIATION|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|WB_2470_PEACE_OPE...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|WB_936_ALTERNATIV...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|WB_2432_FRAGILITY...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|WB_843_DISPUTE_RE...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|WB_2471_PEACEKEEPING|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|            ELECTION|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|USPEC_POLITICS_GE...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|                    |\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|          TAX_FNCACT|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917| TAX_FNCACT_DIRECTOR|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917| TAX_POLITICAL_PARTY|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|TAX_POLITICAL_PAR...|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|USPEC_POLITICS_GE...|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|        UNEMPLOYMENT|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|UNGP_JOB_OPPORTUN...|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|               TRIAL|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|          HARASSMENT|\n+----------------+----------------+--------------+---------+----+----------+--------------------+\nonly showing top 100 rows\n\nnewNames: Seq[String] = List(gkgrecordid, sourcecommonname, date, monthyear, year, tone, themes)\ngkgDF_R3_themes_final: org.apache.spark.sql.DataFrame = [gkgrecordid: string, sourcecommonname: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719669_1874119144","id":"20200123-172721_1485509597","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5680"},{"text":"CREATE TABLE r3_themes (gkgrecordid text, sourcecommonname text, date text, monthyear text, year text, tone text,  themes text, PRIMARY KEY (gkgrecordid, themes));","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719669_-964211104","id":"20200123-223801_28273184","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5681"},{"text":"gkgDF_R3_themes_final.write\n  .cassandraFormat(\"r3_themes\", \"gdelt_space\")\n  .mode(\"overwrite\")\n  .option(\"confirm.truncate\",\"true\")\n  .save()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1579860719670_1864857171","id":"20200123-172452_704927570","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5682"},{"text":"%md\n### Personnes","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Personnes</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1579860719670_1427660930","id":"20200124-081301_513438008","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5683"},{"text":"val gkgDF_R3_persons1 = gkgDF_R3.na.drop().withColumn(\"Persons\",split(regexp_replace($\"persons\", \"(^\\\\[\\\\[\\\\[)|(\\\\]\\\\]\\\\]$)\", \"\"), \";\")).withColumn(\"v2tone2\", split_tone_udf($\"v2tone\")).drop(\"v2locations\", \"v2tone\", \"themes\")\ngkgDF_R3_persons1.show()\n","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------+--------------+--------------------+--------------------+-----------+\n|      GKGRECORDID|          date|    SourceCommonName|             Persons|    v2tone2|\n+-----------------+--------------+--------------------+--------------------+-----------+\n| 20181201000000-0|20181201000000|           nbc29.com|                  []|     -3.125|\n| 20181201000000-1|20181201000000|       theusnews.com|[akiem hicks, ben...| -1.8181819|\n| 20181201000000-2|20181201000000|            wsar.com|[las vega mccarra...| -1.1661807|\n| 20181201000000-3|20181201000000|     wickedlocal.com|                  []|  5.8333335|\n| 20181201000000-4|20181201000000|    newwestrecord.ca|[melissa burke, j...| -2.9166667|\n| 20181201000000-5|20181201000000|            wrex.com|[david osborne, d...|  -6.766917|\n| 20181201000000-6|20181201000000|      maravipost.com|[shanetta yvette ...|  -8.906882|\n| 20181201000000-7|20181201000000|     wickedlocal.com|                  []|  5.8333335|\n| 20181201000000-8|20181201000000|therolladailynews...|[theresa may, ang...| -2.3386343|\n| 20181201000000-9|20181201000000|     airdrieecho.com|[blaine higgs, er...|  -5.617089|\n|20181201000000-10|20181201000000|   actionnewsjax.com|                  []|  1.8348624|\n|20181201000000-11|20181201000000|      prnewswire.com|      [jason haynes]|  0.7662835|\n|20181201000000-12|20181201000000| businessinsider.com|[felix sater, rob...| -1.9607843|\n|20181201000000-13|20181201000000| businessinsider.com|[donna wieting, d...|  -4.491726|\n|20181201000000-14|20181201000000|geelongadvertiser...|[doris roberts, r...|  3.0042918|\n|20181201000000-15|20181201000000|    theparisnews.com|     [quincy blount]|        0.0|\n|20181201000000-16|20181201000000|    timminstimes.com|[blaine higgs, er...|  -5.617089|\n|20181201000000-17|20181201000000|          wsoctv.com|                  []|  1.8348624|\n|20181201000000-18|20181201000000|           radio.com|[reggie bush, mat...|-0.49115914|\n|20181201000000-19|20181201000000|          whas11.com|[jerome powell, d...| -2.5984251|\n+-----------------+--------------+--------------------+--------------------+-----------+\nonly showing top 20 rows\n\ngkgDF_R3_persons1: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, date: string ... 3 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719671_-1648853328","id":"20200124-081325_1650389702","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5684"},{"text":"val gkgDF_R3_persons2 = gkgDF_R3_persons1.withColumn(\"date2\", $\"date\".cast(StringType)).withColumn(\"monthyear\", compute_month_udf($\"date\")).withColumn(\"year\", compute_year_udf($\"date\")).withColumn(\"v2tone3\", $\"v2tone2\".cast(FloatType)).drop(\"date\", \"v2tone2\")\ngkgDF_R3_persons2.show()\n","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------+--------------------+--------------------+--------------+---------+----+-----------+\n|      GKGRECORDID|    SourceCommonName|             Persons|         date2|monthyear|year|    v2tone3|\n+-----------------+--------------------+--------------------+--------------+---------+----+-----------+\n| 20181201000000-0|           nbc29.com|                  []|20181201000000|   201812|2018|     -3.125|\n| 20181201000000-1|       theusnews.com|[akiem hicks, ben...|20181201000000|   201812|2018| -1.8181819|\n| 20181201000000-2|            wsar.com|[las vega mccarra...|20181201000000|   201812|2018| -1.1661807|\n| 20181201000000-3|     wickedlocal.com|                  []|20181201000000|   201812|2018|  5.8333335|\n| 20181201000000-4|    newwestrecord.ca|[melissa burke, j...|20181201000000|   201812|2018| -2.9166667|\n| 20181201000000-5|            wrex.com|[david osborne, d...|20181201000000|   201812|2018|  -6.766917|\n| 20181201000000-6|      maravipost.com|[shanetta yvette ...|20181201000000|   201812|2018|  -8.906882|\n| 20181201000000-7|     wickedlocal.com|                  []|20181201000000|   201812|2018|  5.8333335|\n| 20181201000000-8|therolladailynews...|[theresa may, ang...|20181201000000|   201812|2018| -2.3386343|\n| 20181201000000-9|     airdrieecho.com|[blaine higgs, er...|20181201000000|   201812|2018|  -5.617089|\n|20181201000000-10|   actionnewsjax.com|                  []|20181201000000|   201812|2018|  1.8348624|\n|20181201000000-11|      prnewswire.com|      [jason haynes]|20181201000000|   201812|2018|  0.7662835|\n|20181201000000-12| businessinsider.com|[felix sater, rob...|20181201000000|   201812|2018| -1.9607843|\n|20181201000000-13| businessinsider.com|[donna wieting, d...|20181201000000|   201812|2018|  -4.491726|\n|20181201000000-14|geelongadvertiser...|[doris roberts, r...|20181201000000|   201812|2018|  3.0042918|\n|20181201000000-15|    theparisnews.com|     [quincy blount]|20181201000000|   201812|2018|        0.0|\n|20181201000000-16|    timminstimes.com|[blaine higgs, er...|20181201000000|   201812|2018|  -5.617089|\n|20181201000000-17|          wsoctv.com|                  []|20181201000000|   201812|2018|  1.8348624|\n|20181201000000-18|           radio.com|[reggie bush, mat...|20181201000000|   201812|2018|-0.49115914|\n|20181201000000-19|          whas11.com|[jerome powell, d...|20181201000000|   201812|2018| -2.5984251|\n+-----------------+--------------------+--------------------+--------------+---------+----+-----------+\nonly showing top 20 rows\n\ngkgDF_R3_persons2: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, SourceCommonName: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719671_-298753655","id":"20200124-081340_1973621901","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5685"},{"text":"val gkgDF_R3_persons3 = gkgDF_R3_persons2.withColumn(\"persons3\", explode($\"persons\")).drop(\"persons\")\ngkgDF_R3_persons3.show()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------------+----------------+--------------+---------+----+----------+--------------------+\n|     GKGRECORDID|SourceCommonName|         date2|monthyear|year|   v2tone3|            persons3|\n+----------------+----------------+--------------+---------+----+----------+--------------------+\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|                    |\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|         akiem hicks|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|    benny cunningham|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|   mitchell trubisky|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|    sherrick mcmanis|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|       bilal nichols|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|   las vega mccarran|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|      jazmin pedraza|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|           las vegas|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|                    |\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|       melissa burke|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        jason kenney|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|         mark norman|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|       david osborne|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|         daisy olivo|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|    shane sidebottom|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|         jeff hoover|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|shanetta yvette w...|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|         john walker|\n|20181201000000-7| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|                    |\n+----------------+----------------+--------------+---------+----+----------+--------------------+\nonly showing top 20 rows\n\ngkgDF_R3_persons3: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, SourceCommonName: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719671_-323091517","id":"20200124-081337_144413829","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5686"},{"text":"val newNames = Seq(\"gkgrecordid\", \"sourcecommonname\", \"date\", \"monthyear\", \"year\", \"tone\", \"persons\")\nval gkgDF_R3_persons_final = gkgDF_R3_persons3.toDF(newNames: _*)\nprintln(gkgDF_R3_persons_final.count())\ngkgDF_R3_persons_final.show()\n","user":"anonymous","dateUpdated":"2020-01-24T10:32:06+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------------+----------------+--------------+---------+----+----------+--------------------+\n|     gkgrecordid|sourcecommonname|          date|monthyear|year|      tone|             persons|\n+----------------+----------------+--------------+---------+----+----------+--------------------+\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|                    |\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|         akiem hicks|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|    benny cunningham|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|   mitchell trubisky|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|    sherrick mcmanis|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|       bilal nichols|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|   las vega mccarran|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|      jazmin pedraza|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|           las vegas|\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|                    |\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|       melissa burke|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        jason kenney|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|         mark norman|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|       david osborne|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|         daisy olivo|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|    shane sidebottom|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|         jeff hoover|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|shanetta yvette w...|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|         john walker|\n|20181201000000-7| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|                    |\n+----------------+----------------+--------------+---------+----+----------+--------------------+\nonly showing top 20 rows\n\nnewNames: Seq[String] = List(gkgrecordid, sourcecommonname, date, monthyear, year, tone, persons)\ngkgDF_R3_persons_final: org.apache.spark.sql.DataFrame = [gkgrecordid: string, sourcecommonname: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719671_-636297391","id":"20200124-081336_1845595482","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5687"},{"text":"CREATE TABLE r3_persons (gkgrecordid text, sourcecommonname text, date text, monthyear text, year text, tone float,  persons text, PRIMARY KEY (gkgrecordid, persons));","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719671_1944416179","id":"20200124-081823_523180163","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5688"},{"text":"gkgDF_R3_persons_final.write\n  .cassandraFormat(\"r3_persons\", \"gdelt_space\")\n  .mode(\"overwrite\")\n  .option(\"confirm.truncate\",\"true\")\n  .save()\n","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1579860719671_1600132796","id":"20200124-081326_1687941442","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5689"},{"text":"%md\n### Lieux","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Lieux</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1579860719672_1940349971","id":"20200124-082413_2003020532","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5690"},{"text":"val gkgDF_R3_locations1 = gkgDF_R3.na.drop().withColumn(\"locations\",split(regexp_replace($\"v2locations\", \"(^\\\\[\\\\[\\\\[)|(\\\\]\\\\]\\\\]$)\", \"\"), \";\")).withColumn(\"v2tone2\", split_tone_udf($\"v2tone\")).drop(\"v2locations\", \"v2tone\", \"themes\", \"Persons\")\r\ngkgDF_R3_locations1.show()","user":"anonymous","dateUpdated":"2020-01-24T10:32:16+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------+--------------+--------------------+--------------------+-----------+\n|      GKGRECORDID|          date|    SourceCommonName|           locations|    v2tone2|\n+-----------------+--------------+--------------------+--------------------+-----------+\n| 20181201000000-0|20181201000000|           nbc29.com|[3#Fitchburg, Mas...|     -3.125|\n| 20181201000000-1|20181201000000|       theusnews.com|[3#Chicago, Illin...| -1.8181819|\n| 20181201000000-2|20181201000000|            wsar.com|                  []| -1.1661807|\n| 20181201000000-3|20181201000000|     wickedlocal.com|                  []|  5.8333335|\n| 20181201000000-4|20181201000000|    newwestrecord.ca|[4#Quebec, Quebec...| -2.9166667|\n| 20181201000000-5|20181201000000|            wrex.com|[2#Kentucky, Unit...|  -6.766917|\n| 20181201000000-6|20181201000000|      maravipost.com|[2#Florida, Unite...|  -8.906882|\n| 20181201000000-7|20181201000000|     wickedlocal.com|                  []|  5.8333335|\n| 20181201000000-8|20181201000000|therolladailynews...|[1#Russia#RS#RS##...| -2.3386343|\n| 20181201000000-9|20181201000000|     airdrieecho.com|[4#Saskatchewan, ...|  -5.617089|\n|20181201000000-10|20181201000000|   actionnewsjax.com|                  []|  1.8348624|\n|20181201000000-11|20181201000000|      prnewswire.com|[4#London, London...|  0.7662835|\n|20181201000000-12|20181201000000| businessinsider.com|[1#Russian#RS#RS#...| -1.9607843|\n|20181201000000-13|20181201000000| businessinsider.com|[2#Delaware, Unit...|  -4.491726|\n|20181201000000-14|20181201000000|geelongadvertiser...|                  []|  3.0042918|\n|20181201000000-15|20181201000000|    theparisnews.com|                  []|        0.0|\n|20181201000000-16|20181201000000|    timminstimes.com|[4#Saskatchewan, ...|  -5.617089|\n|20181201000000-17|20181201000000|          wsoctv.com|                  []|  1.8348624|\n|20181201000000-18|20181201000000|           radio.com|                  []|-0.49115914|\n|20181201000000-19|20181201000000|          whas11.com|[1#Argentina#AR#A...| -2.5984251|\n+-----------------+--------------+--------------------+--------------------+-----------+\nonly showing top 20 rows\n\ngkgDF_R3_locations1: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, date: string ... 3 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719672_-1517586234","id":"20200124-082434_779074032","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5691"},{"text":"val gkgDF_R3_locations2 = gkgDF_R3_locations1.withColumn(\"date2\", $\"date\".cast(StringType)).withColumn(\"monthyear\", compute_month_udf($\"date\")).withColumn(\"year\", compute_year_udf($\"date\")).withColumn(\"v2tone3\", $\"v2tone2\".cast(FloatType)).drop(\"date\", \"v2tone2\", \"themes2\")\ngkgDF_R3_locations2.show()","user":"anonymous","dateUpdated":"2020-01-24T10:32:24+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------+--------------------+--------------------+--------------+---------+----+-----------+\n|      GKGRECORDID|    SourceCommonName|           locations|         date2|monthyear|year|    v2tone3|\n+-----------------+--------------------+--------------------+--------------+---------+----+-----------+\n| 20181201000000-0|           nbc29.com|[3#Fitchburg, Mas...|20181201000000|   201812|2018|     -3.125|\n| 20181201000000-1|       theusnews.com|[3#Chicago, Illin...|20181201000000|   201812|2018| -1.8181819|\n| 20181201000000-2|            wsar.com|                  []|20181201000000|   201812|2018| -1.1661807|\n| 20181201000000-3|     wickedlocal.com|                  []|20181201000000|   201812|2018|  5.8333335|\n| 20181201000000-4|    newwestrecord.ca|[4#Quebec, Quebec...|20181201000000|   201812|2018| -2.9166667|\n| 20181201000000-5|            wrex.com|[2#Kentucky, Unit...|20181201000000|   201812|2018|  -6.766917|\n| 20181201000000-6|      maravipost.com|[2#Florida, Unite...|20181201000000|   201812|2018|  -8.906882|\n| 20181201000000-7|     wickedlocal.com|                  []|20181201000000|   201812|2018|  5.8333335|\n| 20181201000000-8|therolladailynews...|[1#Russia#RS#RS##...|20181201000000|   201812|2018| -2.3386343|\n| 20181201000000-9|     airdrieecho.com|[4#Saskatchewan, ...|20181201000000|   201812|2018|  -5.617089|\n|20181201000000-10|   actionnewsjax.com|                  []|20181201000000|   201812|2018|  1.8348624|\n|20181201000000-11|      prnewswire.com|[4#London, London...|20181201000000|   201812|2018|  0.7662835|\n|20181201000000-12| businessinsider.com|[1#Russian#RS#RS#...|20181201000000|   201812|2018| -1.9607843|\n|20181201000000-13| businessinsider.com|[2#Delaware, Unit...|20181201000000|   201812|2018|  -4.491726|\n|20181201000000-14|geelongadvertiser...|                  []|20181201000000|   201812|2018|  3.0042918|\n|20181201000000-15|    theparisnews.com|                  []|20181201000000|   201812|2018|        0.0|\n|20181201000000-16|    timminstimes.com|[4#Saskatchewan, ...|20181201000000|   201812|2018|  -5.617089|\n|20181201000000-17|          wsoctv.com|                  []|20181201000000|   201812|2018|  1.8348624|\n|20181201000000-18|           radio.com|                  []|20181201000000|   201812|2018|-0.49115914|\n|20181201000000-19|          whas11.com|[1#Argentina#AR#A...|20181201000000|   201812|2018| -2.5984251|\n+-----------------+--------------------+--------------------+--------------+---------+----+-----------+\nonly showing top 20 rows\n\ngkgDF_R3_locations2: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, SourceCommonName: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719672_-1497144009","id":"20200124-082433_355781246","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5692"},{"text":"val gkgDF_R3_location3 = gkgDF_R3_locations2.withColumn(\"locations3\", explode($\"locations\")).drop(\"locations\")\ngkgDF_R3_location3.show()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------------+----------------+--------------+---------+----+----------+--------------------+\n|     GKGRECORDID|SourceCommonName|         date2|monthyear|year|   v2tone3|          locations3|\n+----------------+----------------+--------------+---------+----+----------+--------------------+\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|3#Fitchburg, Mass...|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|2#Massachusetts, ...|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|3#Chicago, Illino...|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|3#Chicago, Illino...|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|                    |\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|                    |\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|4#Quebec, Quebec,...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|4#Quebec, Quebec,...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|4#Quebec, Quebec,...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|4#Quebec, Quebec,...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|4#Ottawa, Ontario...|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|1#Canadian#CA#CA#...|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|2#Kentucky, Unite...|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|2#Florida, United...|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|2#Florida, United...|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|3#Broward County,...|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|3#Broward County,...|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|3#Broward County,...|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|3#Dania Beach, Fl...|\n|20181201000000-7| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|                    |\n+----------------+----------------+--------------+---------+----+----------+--------------------+\nonly showing top 20 rows\n\ngkgDF_R3_location3: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, SourceCommonName: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719672_1608702660","id":"20200124-082438_2048789689","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5693"},{"text":"def split_location(location:String) : String = {\n    if (location == null) {\n        return \"\"\n    }\n    else if (location.length >= 1 && (location contains \"#\")) {\n        var res = location split '#'\n        var res2 = res(1)\n        if (location contains \",\") {\n            var res3 = res2 split ','\n            var res4 = res3(0)\n            return res4\n        }\n        return res2\n    }\n    else {\n        return location\n    }\n}\nval split_location_udf = udf(split_location _)\n\nval gkgDF_R3_location4 = gkgDF_R3_location3.na.drop().withColumn(\"locations4\", split_location_udf($\"locations3\")).drop(\"locations3\")\ngkgDF_R3_location4.show()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------------+----------------+--------------+---------+----+----------+--------------+\n|     GKGRECORDID|SourceCommonName|         date2|monthyear|year|   v2tone3|    locations4|\n+----------------+----------------+--------------+---------+----+----------+--------------+\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|     Fitchburg|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125| Massachusetts|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|       Chicago|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|       Chicago|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|              |\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|              |\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        Quebec|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        Quebec|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        Quebec|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        Quebec|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        Ottawa|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|      Canadian|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|      Kentucky|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|       Florida|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|       Florida|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|Broward County|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|Broward County|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|Broward County|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|   Dania Beach|\n|20181201000000-7| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|              |\n+----------------+----------------+--------------+---------+----+----------+--------------+\nonly showing top 20 rows\n\nsplit_location: (location: String)String\nsplit_location_udf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function1>,StringType,Some(List(StringType)))\ngkgDF_R3_location4: org.apache.spark.sql.DataFrame = [GKGRECORDID: string, SourceCommonName: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719672_-1782827502","id":"20200124-082440_165690995","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5694"},{"text":"val newNames = Seq(\"gkgrecordid\", \"sourcecommonname\", \"date\", \"monthyear\", \"year\", \"tone\", \"location\")\nval gkgDF_R3_locations_final = gkgDF_R3_location4.toDF(newNames: _*)\nprintln(.count())\ngkgDF_R3_locations_final.show()","user":"anonymous","dateUpdated":"2020-01-24T10:32:49+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------------+----------------+--------------+---------+----+----------+--------------+\n|     gkgrecordid|sourcecommonname|          date|monthyear|year|      tone|      location|\n+----------------+----------------+--------------+---------+----+----------+--------------+\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125|     Fitchburg|\n|20181201000000-0|       nbc29.com|20181201000000|   201812|2018|    -3.125| Massachusetts|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|       Chicago|\n|20181201000000-1|   theusnews.com|20181201000000|   201812|2018|-1.8181819|       Chicago|\n|20181201000000-2|        wsar.com|20181201000000|   201812|2018|-1.1661807|              |\n|20181201000000-3| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|              |\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        Quebec|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        Quebec|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        Quebec|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        Quebec|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|        Ottawa|\n|20181201000000-4|newwestrecord.ca|20181201000000|   201812|2018|-2.9166667|      Canadian|\n|20181201000000-5|        wrex.com|20181201000000|   201812|2018| -6.766917|      Kentucky|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|       Florida|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|       Florida|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|Broward County|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|Broward County|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|Broward County|\n|20181201000000-6|  maravipost.com|20181201000000|   201812|2018| -8.906882|   Dania Beach|\n|20181201000000-7| wickedlocal.com|20181201000000|   201812|2018| 5.8333335|              |\n+----------------+----------------+--------------+---------+----+----------+--------------+\nonly showing top 20 rows\n\nnewNames: Seq[String] = List(gkgrecordid, sourcecommonname, date, monthyear, year, tone, location)\ngkgDF_R3_locations_final: org.apache.spark.sql.DataFrame = [gkgrecordid: string, sourcecommonname: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719673_-1295550998","id":"20200124-082442_929694245","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5695"},{"text":"CREATE TABLE r3_locations (gkgrecordid text, sourcecommonname text, date text, monthyear text, year text, tone float,  location text, PRIMARY KEY (gkgrecordid, location));","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719673_1081079337","id":"20200124-084926_2025611407","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5696"},{"text":"gkgDF_R3_locations_final.write\n  .cassandraFormat(\"r3_locations\", \"gdelt_space\")\n  .mode(\"overwrite\")\n  .option(\"confirm.truncate\",\"true\")\n  .save()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1579860719673_-1963860314","id":"20200124-082802_261251998","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5697"},{"text":"%md\n## Requête 4","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Requête 4</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1579860719673_1023367868","id":"20200123-172511_468751910","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5698"},{"text":"// Sélection des colonnes nécessaires pour la suite\nval newNames = Seq(\"globaleventid\", \"sqldate\", \"actiongeo_countrycode\", \"actor1countrycode\", \"actor2countrycode\", \"numarticles\", \"avgtone\")\nval eventsDF_R4 = eventsDF.select(\"col_0\", \"col_1\", \"col_53\", \"col_7\", \"col_17\", \"col_33\", \"col_34\").toDF(newNames: _*)\neventsDF_R4.show()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+--------+---------------------+-----------------+-----------------+-----------+-----------------+\n|globaleventid| sqldate|actiongeo_countrycode|actor1countrycode|actor2countrycode|numarticles|          avgtone|\n+-------------+--------+---------------------+-----------------+-----------------+-----------+-----------------+\n|    890018526|20181201|                   UK|                 |              GBR|          2|-8.74587458745875|\n|    890018527|20181201|                   UK|                 |                 |          6|-2.80898876404495|\n|    890018528|20181201|                   UK|                 |              GBR|          4|-2.80898876404495|\n|    890018529|20181201|                   PK|              GBR|              PAK|          4|-7.36775818639798|\n|    890018530|20181201|                   AF|              GBR|              PAK|          4|-7.36775818639798|\n|    890018531|20181201|                   PK|              GBR|              PAK|          4|-7.36775818639798|\n|    890018532|20181201|                   AF|              GBR|              PAK|          4|-7.36775818639798|\n|    890018533|20181201|                   PK|              GBR|              PAK|          8|-7.36775818639798|\n|    890018534|20181201|                   PK|              GBR|              PAK|          8|-7.36775818639798|\n|    890018535|20181201|                   PK|              GBR|                 |          4|-7.36775818639798|\n|    890018536|20181201|                   PK|              GBR|                 |          4|-7.36775818639798|\n|    890018537|20191101|                   AS|              AUS|                 |          8|-5.98802395209581|\n|    890018538|20191101|                   AS|              AUS|                 |          8|-5.98802395209581|\n|    890018539|20191101|                   AS|                 |                 |          2|-5.98802395209581|\n|    890018540|20191101|                   AS|                 |                 |          2|-5.98802395209581|\n|    890018541|20191101|                   SY|                 |              SYR|          2|-1.97421434327156|\n|    890018542|20191101|                   SY|                 |              SYR|          2|-1.97421434327156|\n|    890018543|20191101|                   SY|                 |              SYR|          6|-1.97421434327156|\n|    890018544|20191124|                   UK|              FRA|                 |          4|-7.36775818639798|\n|    890018545|20191124|                   FR|              FRA|                 |         16|-7.36775818639798|\n+-------------+--------+---------------------+-----------------+-----------------+-----------+-----------------+\nonly showing top 20 rows\n\nnewNames: Seq[String] = List(globaleventid, sqldate, actiongeo_countrycode, actor1countrycode, actor2countrycode, numarticles, avgtone)\neventsDF_R4: org.apache.spark.sql.DataFrame = [globaleventid: string, sqldate: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719674_-978045048","id":"20200123-183855_1136444388","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5699"},{"text":"val eventsDF_R4_cleaned = eventsDF_R4.withColumn(\"monthyear\", compute_month_udf($\"sqldate\")).withColumn(\"year\", compute_year_udf($\"sqldate\"))\nprintln(eventsDF_R4_cleaned.count())\neventsDF_R4_cleaned.show()","user":"anonymous","dateUpdated":"2020-01-24T10:32:53+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+--------+---------------------+-----------------+-----------------+-----------+-----------------+---------+----+\n|globaleventid| sqldate|actiongeo_countrycode|actor1countrycode|actor2countrycode|numarticles|          avgtone|monthyear|year|\n+-------------+--------+---------------------+-----------------+-----------------+-----------+-----------------+---------+----+\n|    890018526|20181201|                   UK|                 |              GBR|          2|-8.74587458745875|   201812|2018|\n|    890018527|20181201|                   UK|                 |                 |          6|-2.80898876404495|   201812|2018|\n|    890018528|20181201|                   UK|                 |              GBR|          4|-2.80898876404495|   201812|2018|\n|    890018529|20181201|                   PK|              GBR|              PAK|          4|-7.36775818639798|   201812|2018|\n|    890018530|20181201|                   AF|              GBR|              PAK|          4|-7.36775818639798|   201812|2018|\n|    890018531|20181201|                   PK|              GBR|              PAK|          4|-7.36775818639798|   201812|2018|\n|    890018532|20181201|                   AF|              GBR|              PAK|          4|-7.36775818639798|   201812|2018|\n|    890018533|20181201|                   PK|              GBR|              PAK|          8|-7.36775818639798|   201812|2018|\n|    890018534|20181201|                   PK|              GBR|              PAK|          8|-7.36775818639798|   201812|2018|\n|    890018535|20181201|                   PK|              GBR|                 |          4|-7.36775818639798|   201812|2018|\n|    890018536|20181201|                   PK|              GBR|                 |          4|-7.36775818639798|   201812|2018|\n|    890018537|20191101|                   AS|              AUS|                 |          8|-5.98802395209581|   201911|2019|\n|    890018538|20191101|                   AS|              AUS|                 |          8|-5.98802395209581|   201911|2019|\n|    890018539|20191101|                   AS|                 |                 |          2|-5.98802395209581|   201911|2019|\n|    890018540|20191101|                   AS|                 |                 |          2|-5.98802395209581|   201911|2019|\n|    890018541|20191101|                   SY|                 |              SYR|          2|-1.97421434327156|   201911|2019|\n|    890018542|20191101|                   SY|                 |              SYR|          2|-1.97421434327156|   201911|2019|\n|    890018543|20191101|                   SY|                 |              SYR|          6|-1.97421434327156|   201911|2019|\n|    890018544|20191124|                   UK|              FRA|                 |          4|-7.36775818639798|   201911|2019|\n|    890018545|20191124|                   FR|              FRA|                 |         16|-7.36775818639798|   201911|2019|\n+-------------+--------+---------------------+-----------------+-----------------+-----------+-----------------+---------+----+\nonly showing top 20 rows\n\neventsDF_R4_cleaned: org.apache.spark.sql.DataFrame = [globaleventid: string, sqldate: string ... 7 more fields]\n"}]},"apps":[],"jobName":"paragraph_1579860719674_-1301172963","id":"20200123-191441_780979394","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5700"},{"text":"CREATE TABLE r4 (globaleventid text, sqldate text, actiongeo_countrycode text, actor1countrycode text, actor2countrycode text, numarticles text, avgtone text, monthyear text, year text, PRIMARY KEY (globaleventid));","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719674_764908655","id":"20200123-183855_716431550","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5701"},{"text":"eventsDF_R4_cleaned.write\n  .cassandraFormat(\"r4\", \"gdelt_space\")\n  .mode(\"overwrite\")\n  .option(\"confirm.truncate\",\"true\")\n  .save()","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719674_1097220780","id":"20200123-185729_979688280","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5702"},{"text":"","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719674_-67637534","id":"20200123-190016_1464934331","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5703"},{"user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719675_1037343672","id":"20200123-190033_214413057","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5704"},{"text":"\r\n","user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719675_-826189142","id":"20200123-183854_1320611599","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5705"},{"user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719675_-1803051543","id":"20200123-172512_1456076424","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5706"},{"user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719675_-188603574","id":"20200123-161419_370953900","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5707"},{"user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719675_525554706","id":"20200123-161420_219926060","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5708"},{"user":"anonymous","dateUpdated":"2020-01-24T10:11:59+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1579860719675_1657827754","id":"20200123-161423_2020522519","dateCreated":"2020-01-24T10:11:59+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5709"}],"name":"feed-cassandra","id":"2F1MQYNHJ","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}